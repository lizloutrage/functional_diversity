<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liz Loutrage">

<title>index</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="index_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="index_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="index_files/libs/datatables-binding-0.30/datatables.js"></script>
<script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="index_files/libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="index_files/libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="index_files/libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="index_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="index_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#questions" id="toc-questions" class="nav-link active" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">1. Data preparation</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">summary</a></li>
  <li><a href="#species-traits" id="toc-species-traits" class="nav-link" data-scroll-target="#species-traits">Species * traits</a>
  <ul class="collapse">
  <li><a href="#data-imputation" id="toc-data-imputation" class="nav-link" data-scroll-target="#data-imputation">data imputation</a></li>
  <li><a href="#calctulate-functional-traits" id="toc-calctulate-functional-traits" class="nav-link" data-scroll-target="#calctulate-functional-traits">calctulate functional traits</a></li>
  </ul></li>
  <li><a href="#species-assemblages-matrix" id="toc-species-assemblages-matrix" class="nav-link" data-scroll-target="#species-assemblages-matrix">Species * assemblages matrix</a></li>
  <li><a href="#traits-types" id="toc-traits-types" class="nav-link" data-scroll-target="#traits-types">Traits types</a></li>
  </ul></li>
  <li><a href="#build-a-functional-space-using-the-mfd-package" id="toc-build-a-functional-space-using-the-mfd-package" class="nav-link" data-scroll-target="#build-a-functional-space-using-the-mfd-package">2. Build a functional space using the mFD package</a>
  <ul class="collapse">
  <li><a href="#compute-data-summaries" id="toc-compute-data-summaries" class="nav-link" data-scroll-target="#compute-data-summaries">2.1 Compute data summaries</a></li>
  <li><a href="#computing-distances-between-species-based-on-functional-traits" id="toc-computing-distances-between-species-based-on-functional-traits" class="nav-link" data-scroll-target="#computing-distances-between-species-based-on-functional-traits">2.2 Computing distances between species based on functional traits</a></li>
  <li><a href="#building-functional-spaces-and-chosing-the-best-one" id="toc-building-functional-spaces-and-chosing-the-best-one" class="nav-link" data-scroll-target="#building-functional-spaces-and-chosing-the-best-one">2.3 Building functional spaces and chosing the best one</a>
  <ul class="collapse">
  <li><a href="#computing-several-multimensional-functional-spaces-and-assessing-their-quality" id="toc-computing-several-multimensional-functional-spaces-and-assessing-their-quality" class="nav-link" data-scroll-target="#computing-several-multimensional-functional-spaces-and-assessing-their-quality">2.3.1 Computing several multimensional functional spaces and assessing their quality</a></li>
  <li><a href="#illustrating-the-quality-of-the-functional-spaces" id="toc-illustrating-the-quality-of-the-functional-spaces" class="nav-link" data-scroll-target="#illustrating-the-quality-of-the-functional-spaces">2.3.2 Illustrating the quality of the functional spaces</a></li>
  <li><a href="#testing-the-correlation-between-functional-axes-and-traits" id="toc-testing-the-correlation-between-functional-axes-and-traits" class="nav-link" data-scroll-target="#testing-the-correlation-between-functional-axes-and-traits">2.3.3 Testing the correlation between functional axes and traits</a></li>
  </ul></li>
  <li><a href="#plotting-the-selected-functional-space-and-position-of-species" id="toc-plotting-the-selected-functional-space-and-position-of-species" class="nav-link" data-scroll-target="#plotting-the-selected-functional-space-and-position-of-species">2.4 Plotting the selected functional space and position of species</a></li>
  </ul></li>
  <li><a href="#computing-and-plotting-beta-fd-indices" id="toc-computing-and-plotting-beta-fd-indices" class="nav-link" data-scroll-target="#computing-and-plotting-beta-fd-indices">3. Computing and plotting beta FD indices</a></li>
  <li><a href="#functional-rarity" id="toc-functional-rarity" class="nav-link" data-scroll-target="#functional-rarity">4. Functional rarity</a>
  <ul class="collapse">
  <li><a href="#different-indices-of-functional-rarity" id="toc-different-indices-of-functional-rarity" class="nav-link" data-scroll-target="#different-indices-of-functional-rarity">4.1 Different indices of functional rarity</a></li>
  <li><a href="#computing-functional-rarity" id="toc-computing-functional-rarity" class="nav-link" data-scroll-target="#computing-functional-rarity">4.2.Computing functional rarity</a>
  <ul class="collapse">
  <li><a href="#functional-originality-at-regional-scale" id="toc-functional-originality-at-regional-scale" class="nav-link" data-scroll-target="#functional-originality-at-regional-scale">4.2.1 Functional originality at regional scale</a></li>
  <li><a href="#functional-originality-at-local-scale" id="toc-functional-originality-at-local-scale" class="nav-link" data-scroll-target="#functional-originality-at-local-scale">4.2.2 Functional originality at local scale</a></li>
  </ul></li>
  <li><a href="#plotting-functional-rarity" id="toc-plotting-functional-rarity" class="nav-link" data-scroll-target="#plotting-functional-rarity">4.3 Plotting functional rarity</a>
  <ul class="collapse">
  <li><a href="#plotting-functional-originality" id="toc-plotting-functional-originality" class="nav-link" data-scroll-target="#plotting-functional-originality">4.3.1 Plotting functional originality</a></li>
  <li><a href="#plotting-rarity" id="toc-plotting-rarity" class="nav-link" data-scroll-target="#plotting-rarity">4.3.2. Plotting rarity</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">index</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Liz Loutrage </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="questions" class="level1">
<h1>Questions</h1>
<ul>
<li><p><span style="color:#2596be;"><strong>β-functional diversity</strong></span>: calcul des indices de dissimilarité entre les assemblages (profondeurs) : profondeur = filtre environnemental ?</p>
<ul>
<li><p><em>Turnover</em>: élevé s’il n’y a pas de combinaison de traits partagés entre les assemblages</p></li>
<li><p><em>Nestedness component</em>: élevé si un assemblage abrite un petit sous-ensemble des stratégies fonctionnelles présentes dans l’autre</p></li>
</ul></li>
<li><p><span style="color:#2596be;"><strong>Functional rarity</strong></span>:</p>
<ul>
<li>Différencier échelle locale et régionale ?</li>
<li>inclure abondance/biomasse ?</li>
<li>y a t-il beaucoup d’espèces avec des combinaisons de traits uniques ?</li>
<li>y a en t-il plus en profondeur ?</li>
<li>les espèces fonctionnellement rares ont t-elles une distribution plus restreinte ?</li>
</ul></li>
</ul>
</section>
<section id="data-preparation" class="level1">
<h1>1. Data preparation</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>morphometric_data <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"morphometrics_data.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>morpho_data <span class="ot">&lt;-</span> morphometric_data <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(variable_abbreviation, variable_unit)) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">row_to_names</span>(<span class="at">row_number =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">rownames&lt;-</span><span class="st">`</span>(<span class="cn">NULL</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># delete for now (n=1)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">!=</span> <span class="st">"Diaphus_sp"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># replace empty value by NA </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>morpho_data[morpho_data <span class="sc">==</span><span class="st">""</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric variables</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>morpho_data[, <span class="dv">4</span><span class="sc">:</span><span class="dv">23</span>] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(morpho_data[, <span class="dv">4</span><span class="sc">:</span><span class="dv">23</span>], as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">summary</h3>
<ul>
<li>total measure = 359</li>
<li>total of species measured = 32</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>morpho_data_summary <span class="ot">&lt;-</span>morpho_data <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(species)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(morpho_data_summary))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7d1d75907b0ca3621ce6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7d1d75907b0ca3621ce6">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],["Anoplogaster_cornuta","Argyropelecus_hemigymnus","Bathylagus_euryops","Benthosema_glaciale","Bolinichthys_supralateralis","Borostomias_antarcticus","Chauliodus_sloani","Cyclothone_sp","Derichthys_serpentinus","Diaphus_metoclampus","Eurypharynx_pelecanoides","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Holtbyrnia_macrops","Lampanyctus_ater","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Malacosteus_niger","Maulisia_argipalla","Maulisia_mauli","Maulisia_microlepis","Maurolicus_muelleri","Melanostigma_atlanticum","Melanostomias_bartonbeani","Notoscopelus_bolini","Paralepis_coregonoides ","Photostylus_pycnopterus","Sagamichthys_schnakenbecki","Sigmops_bathyphilus"],[3,17,19,20,11,14,12,12,7,5,6,4,3,3,9,22,21,7,22,5,5,11,4,11,20,9,20,19,8,9,20]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>species<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="species-traits" class="level2">
<h2 class="anchored" data-anchor-id="species-traits">Species * traits</h2>
<section id="data-imputation" class="level3">
<h3 class="anchored" data-anchor-id="data-imputation">data imputation</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select numeric variables for imputation </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>morpho_num <span class="ot">&lt;-</span> morpho_data <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>imputed_data <span class="ot">&lt;-</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  mice<span class="sc">::</span><span class="fu">mice</span>(morpho_num,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">m =</span> <span class="dv">5</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">maxit =</span> <span class="dv">50</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"pmm"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">printFlag=</span>F)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>completed_data <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">complete</span>(imputed_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calctulate-functional-traits" class="level3">
<h3 class="anchored" data-anchor-id="calctulate-functional-traits">calctulate functional traits</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate functional numeric traits</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>morpho_numeric <span class="ot">&lt;-</span> completed_data <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>individual_code) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">eye_size =</span> eye_diameter <span class="sc">/</span> head_depth,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">orbital_length =</span> eye_diameter <span class="sc">/</span> standard_length,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">oral_gap_surface =</span> mouth_width <span class="sc">*</span> mouth_depth <span class="sc">/</span> body_width <span class="sc">*</span> body_depth,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">oral_gape_shape =</span> mouth_depth <span class="sc">/</span> mouth_width,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">oral_gape_position =</span> distance_upper_jaws_bottom_head <span class="sc">/</span> head_depth,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_jaw_length =</span> lower_jaw_length <span class="sc">/</span> standard_length,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">head_length =</span> head_length <span class="sc">/</span> standard_length,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_depth =</span> body_depth <span class="sc">/</span> standard_length,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pectoral_fin_position =</span> distance_pectoral_bottom_body <span class="sc">/</span> body_depth_pectoral_insertion,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pectoral_fin_insertion =</span> prepectoral_length <span class="sc">/</span> standard_length,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">transversal_shape =</span> body_depth <span class="sc">/</span> body_width,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">dorsal_fin_insertion =</span> predorsal_length <span class="sc">/</span> standard_length,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">eye_position =</span> eye_height <span class="sc">/</span> head_depth,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">operculum_volume =</span> operculum_depth <span class="sc">/</span> operculum_width</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    species,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    eye_size,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    orbital_length,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    oral_gap_surface,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    oral_gape_shape,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    oral_gape_position,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    lower_jaw_length,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    operculum_width,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    head_length,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    body_depth,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    pectoral_fin_position,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    pectoral_fin_insertion,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    transversal_shape,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    caudal_peduncle_min_depth,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    dorsal_fin_insertion,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    eye_position,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    operculum_volume</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># categorial traits for species without NA</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>cat_morpho <span class="ot">&lt;-</span> morpho_data <span class="sc">%&gt;%</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    species,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    photophores_ventral_position ,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    gland_head,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    chin_barbel,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    front_barbel,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    small_teeth,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    large_teeth,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    fang_teeth,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    retractile_teeth,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    internal_teeth,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    gill_raker_types,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    oral_gape_axis</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co"># combined the two data frames</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>fish_traits <span class="ot">&lt;-</span> morpho_numeric <span class="sc">%&gt;%</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(cat_morpho, <span class="at">by =</span> <span class="st">"species"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"species"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign trait type </span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.factor for qualitative traits</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.factor)<span class="sc">%&gt;%</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.ordered for odered variables</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"gill_raker_types"</span>, <span class="st">"oral_gape_axis"</span>), as.ordered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Display the table ----</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(fish_traits))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e0a1729bad976b0040ef" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e0a1729bad976b0040ef">{"x":{"filter":"none","vertical":false,"data":[["Anoplogaster_cornuta","Bathylagus_euryops","Bolinichthys_supralateralis","Borostomias_antarcticus","Chauliodus_sloani","Cyclothone_sp","Diaphus_metoclampus","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Lampanyctus_ater","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Maulisia_mauli","Maurolicus_muelleri","Melanostomias_bartonbeani","Notoscopelus_bolini","Photostylus_pycnopterus","Sagamichthys_schnakenbecki"],[0.1870635427569378,0.8073379156515913,0.6943542959568116,0.3918502902611463,0.3236216278441371,0.2896732995527421,0.3965409748630725,0.4619095739058715,0.2627730950311468,0.7001620679316158,0.5876906171451259,0.4635401519874494,0.6379293967644859,0.4655204987772433,0.5436602586272192,0.5366700102175092,0.3404604909527202,0.58721677071155,0.3160340663331095,0.6531117613886723],[0.06513101563336203,0.09773731823878731,0.1002020784107539,0.0454502028499367,0.03195944404217845,0.01820101324427989,0.08617787828321036,0.06111392066224541,0.02365859567134613,0.107319044568802,0.04953860514578357,0.05324648475404745,0.03316666671153076,0.06137020103787766,0.0843550572708857,0.0978961923388425,0.02667037338846572,0.06117253100231441,0.03048020374468671,0.08748603143506498],[5842.317456564917,215.6744532820656,857.141772877457,2308.803855788343,1427.556961259949,479.1419350759956,509.9151356625916,746.3340129817943,6250.383835528853,1018.142068749161,1516.361659863597,2223.938773657847,191.888446067941,1226.901459954854,2055.911596674011,186.8514118522354,2537.245636289088,486.4451319733718,80.09634693327251,858.57580241159],[0.6488731902095241,1.208429987743106,1.145308631944953,0.9549389452177165,2.198671222745045,2.168647464401632,0.944195077723388,1.283292920158411,0.6068674018540213,1.051271164630917,1.144873224338048,1.162473804130551,2.185143165036392,1.100038150697565,1.163701414828532,1.285170782096033,1.398821013856888,1.278747111079255,1.080061200669548,1.203470421502817],[0.3951426840833095,0.3502518371432042,0.3380289556040331,0.4826993703447641,0.7068627312794583,0.7937932689673789,0.3551554524927789,0.5829657156202231,0.4721898773185077,0.4712003973315194,0.5769849659973523,0.5744746730161431,0.5520998821851169,0.5212153959103951,0.3738738564459647,0.5855853143839959,0.6176663797525285,0.4896021576606608,0.5624538104272562,0.361697362365493],[0.2861375317012913,0.07506640738457124,0.19638076001865,0.198414842989372,0.1144114643871464,0.2040581908463124,0.191587307998245,0.1634947940484265,0.1777783246347302,0.2092942077891755,0.1973450981018806,0.2048825282290511,0.1027761390567869,0.2223712374577787,0.2120154019923103,0.166670163223075,0.1234687560304594,0.2008815666871479,0.08475918421735412,0.1571232489521016],[20.92,8.536315789473685,12.47272727272727,15.79642857142857,9.851666666666667,7.613333333333333,6.976,9.282500000000001,27.92,9.563333333333333,18.38136363636364,25.00333333333333,4.928571428571429,15.45818181818182,15.73,3.591818181818182,18.11777777777778,9.629,6.5525,11.76],[0.3471179569492232,0.2214198161904544,0.2949444282485461,0.2219516612342632,0.1353122370036637,0.2203047019193976,0.2626215465872482,0.2169720130174164,0.208131053502031,0.3736914296278676,0.2268293066821225,0.2544000525765622,0.179483203158696,0.2690716828129346,0.3386367195769682,0.2861583530888247,0.1414616221329245,0.2484099358389354,0.1610794295053864,0.3035521067765809],[0.496765317595603,0.1776310863316782,0.23575289155312,0.1471579276088384,0.1139788839951372,0.1385564389886054,0.2794661893586785,0.1854842390181648,0.1439966534398835,0.1995718556257012,0.1634270563148341,0.1791292477891186,0.07016698379208147,0.2389029851391781,0.2006259493110997,0.2284769602774343,0.1281404978381019,0.1977431521215698,0.148949033138653,0.1648207240422557],[0.327552178795381,0.1987584730572414,0.4605590043104663,0.1754328409583324,0.289631998528789,0.1992742880547905,0.2327118342280331,0.215888746321026,0.2073022595505449,0.2511962839831692,0.2900486043297842,0.1868404720220886,0.3583607039010895,0.2710821884027898,0.1907795219830297,0.2251067492779084,0.2233648323381441,0.2851868407331372,0.4749769701497314,0.22306401155431],[0.4003208996368177,0.2584814374106652,0.3283279074114032,0.2369008386437003,0.1525109091904405,0.2296622405613443,0.3359303818851376,0.234931461549684,0.2185105436064756,0.3836208813775061,0.255430600290693,0.3991766831105948,0.1873220233715019,0.2905759860794116,0.3636636301971131,0.2720666504252247,0.1596798610655336,0.2755915950773311,0.1830307523791412,0.3649543206763802],[0.0371234059465991,0.03242347415555417,0.01988857958867888,0.03631916674726406,0.01525793056447875,0.07135857193615111,0.05850109312007883,0.0330170205426,0.01553375842430409,0.06429066383512382,0.02463758734428551,0.01871587454424042,0.01805418174713717,0.03025781637891173,0.03196526524002068,0.1787182752269798,0.01959986641736065,0.02763011114739326,0.02971955680387246,0.04254465702825964],[10.45666666666667,6.301578947368421,10.79727272727273,5.527142857142857,6.194166666666667,2.8375,5.86,6.265,12.76,4.013333333333334,8.561818181818182,13.30904761904762,2.92,8.897727272727273,7.612727272727272,2.204545454545455,4.792222222222223,6.7935,3.58375,5.828888888888889],[0.4441498752678317,0.4637086703778667,0.4469769590756064,0.555896646135866,0.2551650456937953,0.5434318108133503,0.4068008790692222,0.4314272231538535,0.5671939001428983,0.6326973503856025,0.4410062335674381,0.4509057936924641,0.5980112926718268,0.4076621012576387,0.6344647156330613,0.5480099853470315,0.8479658564847968,0.3681530667791175,0.7766759118958205,0.6195601138458109],[0.7176935425650939,0.6759418666886342,0.5912844468134186,0.6406218602628342,0.7608914348764781,0.9524117126142014,0.5025961273814956,0.8025189634953906,0.6875363082898668,0.6816922245429579,0.6434772867086079,0.6741368657991837,0.6136384769387926,0.6326776614466724,0.6352660702821236,0.6295496228498633,0.7023241150122855,0.5509132572485328,0.7832793790368987,0.5912461332246149],[1.91753487412749,1.124312726235241,1.266547465086961,0.9001426533263226,2.261636205418431,1.039677210085933,1.6964688060974,1.342729773708559,1.125109185048073,1.005414520892331,0.745538622186577,0.6972474697559381,1.425927736117199,0.9216188402082974,1.1351500186845,1.403601622773818,1.484009375370477,1.031327676466461,1.436677037589144,0.9152335515764092],["A","A","P","P","P","P","P","A","P","A","P","P","A","P","P","P","P","P","P","P"],["A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","A","P","A","A","A"],["A","A","A","P","A","A","A","A","A","A","A","A","A","A","A","A","P","A","A","A"],["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["A","P","A","P","A","A","P","A","P","P","P","P","P","P","P","P","A","P","P","P"],["P","A","A","P","P","P","A","P","P","A","A","P","A","P","A","A","P","A","A","A"],["P","A","A","P","P","A","A","P","A","A","A","A","A","A","A","A","P","A","A","A"],["A","A","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","A","A"],["P","P","P","P","A","P","A","A","P","A","P","P","P","P","P","A","P","P","A","A"],["C","C","C","C","A","C","C","A","C","C","C","C","B","C","C","C","A","C","C","C"],["1","2","2","2","1","2","1","1","1","3","2","2","3","2","2","2","3","3","1","2"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eye_size<\/th>\n      <th>orbital_length<\/th>\n      <th>oral_gap_surface<\/th>\n      <th>oral_gape_shape<\/th>\n      <th>oral_gape_position<\/th>\n      <th>lower_jaw_length<\/th>\n      <th>operculum_width<\/th>\n      <th>head_length<\/th>\n      <th>body_depth<\/th>\n      <th>pectoral_fin_position<\/th>\n      <th>pectoral_fin_insertion<\/th>\n      <th>transversal_shape<\/th>\n      <th>caudal_peduncle_min_depth<\/th>\n      <th>dorsal_fin_insertion<\/th>\n      <th>eye_position<\/th>\n      <th>operculum_volume<\/th>\n      <th>photophores_ventral_position<\/th>\n      <th>gland_head<\/th>\n      <th>chin_barbel<\/th>\n      <th>front_barbel<\/th>\n      <th>small_teeth<\/th>\n      <th>large_teeth<\/th>\n      <th>fang_teeth<\/th>\n      <th>retractile_teeth<\/th>\n      <th>internal_teeth<\/th>\n      <th>gill_raker_types<\/th>\n      <th>oral_gape_axis<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="species-assemblages-matrix" class="level2">
<h2 class="anchored" data-anchor-id="species-assemblages-matrix">Species * assemblages matrix</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># species x assemblages (depth) matrix</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list of species </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sp_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rownames</span>(fish_traits), <span class="st">"Nannobrachium_atrum"</span>, <span class="st">"Cyclothone"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># species biomass x depth  matrix 2002-2019</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>data_biomass_2002_2019 <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_biomass_2002_2019.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"species"</span><span class="ot">=</span><span class="st">"Code_Station"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species=</span> <span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>, species))<span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">%in%</span>sp_names)<span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">row_to_names</span>(<span class="at">row_number =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.numeric)<span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Code_Station"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span>Code_Station, <span class="at">names_to =</span> <span class="st">"species"</span>, <span class="at">values_to =</span> <span class="st">"Tot_V_HV"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Nom_Scientifique"</span><span class="ot">=</span><span class="st">"species"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># species biomass x depth  matrix 2021</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>data_biomass_2021 <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_evhoe_catch_2021.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nom_Scientifique, Tot_V_HV, Code_Station)<span class="sc">%&gt;%</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nom_Scientifique=</span> <span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>,Nom_Scientifique))<span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Nom_Scientifique<span class="sc">%in%</span>sp_names)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># species biomass x depth  matrix 2022</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>data_biomass_2022 <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_evhoe_catch_2022.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nom_Scientifique, Tot_V_HV, Code_Station)<span class="sc">%&gt;%</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nom_Scientifique=</span> <span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>,Nom_Scientifique))<span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Nom_Scientifique<span class="sc">%in%</span>sp_names)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># merge all matrix </span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># depht of all stations </span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>depth_station <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"depth.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Code_Station"</span><span class="ot">=</span><span class="st">"Station"</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>depth_fish_biomass <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_biomass_2002_2019, data_biomass_2021, data_biomass_2022)<span class="sc">%&gt;%</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(depth_station)<span class="sc">%&gt;%</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Code_Station <span class="sc">!=</span> <span class="st">"H0472"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"species"</span><span class="ot">=</span><span class="st">"Nom_Scientifique"</span>)<span class="sc">%&gt;%</span>  </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add column with depth layer</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">depth_layer =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">0</span>, <span class="dv">174</span>) <span class="sc">~</span> <span class="st">"Epipelagic"</span>,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">175</span>, <span class="dv">699</span>) <span class="sc">~</span> <span class="st">"Upper mesopelagic"</span>,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">700</span>, <span class="dv">999</span>) <span class="sc">~</span> <span class="st">"Lower mesopelagic"</span>,</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">1000</span>, <span class="dv">2000</span>) <span class="sc">~</span> <span class="st">"Bathypelagic"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>depth)<span class="sc">%&gt;%</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, depth_layer)<span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass=</span><span class="fu">sum</span>(Tot_V_HV))<span class="sc">%&gt;%</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Tot_V_HV, Code_Station))<span class="sc">%&gt;%</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> species, <span class="at">values_from =</span> biomass)<span class="sc">%&gt;%</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"depth_layer"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">2</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">#change species name</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Lampanyctus_ater"</span><span class="ot">=</span><span class="st">"Nannobrachium_atrum"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Cyclothone_sp"</span><span class="ot">=</span><span class="st">"Cyclothone"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><strong>assemblages</strong> = depth layers</li>
<li><strong>biomass data</strong> = all EVHOE data 2002-2022</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(depth_fish_biomass))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-703e42b8747a8a03b523" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-703e42b8747a8a03b523">{"x":{"filter":"none","vertical":false,"data":[["Upper mesopelagic","Bathypelagic","Epipelagic","Lower mesopelagic"],[0,0.1,0,0],[0,2.71,0,0],[0,0.06,0,0.16],[0.02,0.57,0,0.04],[0.04,0.97,0,0.24],[0.11,194.62,0.02,1.44],[0.02,0.05,0,0.37],[0,0.14,0,0.28],[0,0.21,0,0],[0,2.23,0,0],[0.01,0.03,0.06,0.11],[0.14,0.49,0.03,0.09],[0.01,1.38,0,0.05],[0.18,0.5,0.5600000000000001,2.4],[0.28,0.27,0.01,0.16],[0.07000000000000001,1.69,0.01,0.5600000000000001],[0,0.06,0,0],[0.04,0.04,0,0.14],[0,0.08,0.43,0.05]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Anoplogaster_cornuta<\/th>\n      <th>Bathylagus_euryops<\/th>\n      <th>Bolinichthys_supralateralis<\/th>\n      <th>Borostomias_antarcticus<\/th>\n      <th>Chauliodus_sloani<\/th>\n      <th>Cyclothone_sp<\/th>\n      <th>Evermannella_balbo<\/th>\n      <th>Gonostoma_elongatum<\/th>\n      <th>Holtbyrnia_anomala<\/th>\n      <th>Lampanyctus_macdonaldi<\/th>\n      <th>Lestidiops_sphyrenoides<\/th>\n      <th>Lobianchia_gemellarii<\/th>\n      <th>Maulisia_mauli<\/th>\n      <th>Maurolicus_muelleri<\/th>\n      <th>Melanostomias_bartonbeani<\/th>\n      <th>Lampanyctus_ater<\/th>\n      <th>Photostylus_pycnopterus<\/th>\n      <th>Sagamichthys_schnakenbecki<\/th>\n      <th>Notoscopelus_bolini<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="traits-types" class="level2">
<h2 class="anchored" data-anchor-id="traits-types">Traits types</h2>
<p>The <strong>first column</strong> contains <strong>traits name</strong>. The <strong>second column</strong> contains <strong>traits type</strong> following this code:</p>
<ul>
<li><strong>N</strong>: nominal trait (factor variable)</li>
<li><strong>O</strong>: ordinal traits (ordered variable)</li>
<li><strong>Q</strong>: quantitative traits (numeric values)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fish_traits_cat <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"fish_traits_cat.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(fish_traits_cat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1638ee134afe9a59be04" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1638ee134afe9a59be04">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27"],["eye_size","orbital_length","oral_gap_surface","oral_gape_shape","oral_gape_position","lower_jaw_length","operculum_width","head_length","body_depth","pectoral_fin_position","pectoral_fin_insertion","transversal_shape","caudal_peduncle_min_depth","dorsal_fin_insertion","eye_position","operculum_volume","photophores_ventral_position","gland_head","chin_barbel","front_barbel","small_teeth","large_teeth","fang_teeth","retractile_teeth","internal_teeth","gill_raker_types","oral_gape_axis"],["Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","N","N","N","N","N","N","N","N","N","O","O"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>trait_name<\/th>\n      <th>trait_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="build-a-functional-space-using-the-mfd-package" class="level1">
<h1>2. Build a functional space using the mFD package</h1>
<section id="compute-data-summaries" class="level2">
<h2 class="anchored" data-anchor-id="compute-data-summaries">2.1 Compute data summaries</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Summary of the assemblages * species data.frame ----</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>asb_sp_fish_summ <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">asb.sp.summary</span>(<span class="at">asb_sp_w =</span> depth_fish_biomass)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>asb_sp_fish_occ  <span class="ot">&lt;-</span> asb_sp_fish_summ<span class="sc">$</span><span class="st">"asb_sp_occ"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(asb_sp_fish_occ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d63d226bef40672a6e32" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d63d226bef40672a6e32">{"x":{"filter":"none","vertical":false,"data":[["Upper mesopelagic","Bathypelagic","Epipelagic","Lower mesopelagic"],[0,1,0,0],[0,1,0,0],[0,1,0,1],[1,1,0,1],[1,1,0,1],[1,1,1,1],[1,1,0,1],[0,1,0,1],[0,1,0,0],[0,1,0,0],[1,1,1,1],[1,1,1,1],[1,1,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[0,1,0,0],[1,1,0,1],[0,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Anoplogaster_cornuta<\/th>\n      <th>Bathylagus_euryops<\/th>\n      <th>Bolinichthys_supralateralis<\/th>\n      <th>Borostomias_antarcticus<\/th>\n      <th>Chauliodus_sloani<\/th>\n      <th>Cyclothone_sp<\/th>\n      <th>Evermannella_balbo<\/th>\n      <th>Gonostoma_elongatum<\/th>\n      <th>Holtbyrnia_anomala<\/th>\n      <th>Lampanyctus_macdonaldi<\/th>\n      <th>Lestidiops_sphyrenoides<\/th>\n      <th>Lobianchia_gemellarii<\/th>\n      <th>Maulisia_mauli<\/th>\n      <th>Maurolicus_muelleri<\/th>\n      <th>Melanostomias_bartonbeani<\/th>\n      <th>Lampanyctus_ater<\/th>\n      <th>Photostylus_pycnopterus<\/th>\n      <th>Sagamichthys_schnakenbecki<\/th>\n      <th>Notoscopelus_bolini<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="computing-distances-between-species-based-on-functional-traits" class="level2">
<h2 class="anchored" data-anchor-id="computing-distances-between-species-based-on-functional-traits">2.2 Computing distances between species based on functional traits</h2>
<ul>
<li>We have non-continuous traits so we use the <strong>Gower distance</strong> <em>(metric = “gower”)</em> as this method allows traits weighting.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sp_dist_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">funct.dist</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_tr         =</span> fish_traits,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">tr_cat        =</span> fish_traits_cat,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric        =</span> <span class="st">"gower"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale_euclid  =</span> <span class="st">"scale_center"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ordinal_var   =</span> <span class="st">"classic"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_type   =</span> <span class="st">"equal"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stop_if_NA    =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Output of the function mFD::funct.dist() ----</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(sp_dist_fish, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            Anoplogaster_cornuta Bathylagus_euryops
Bathylagus_euryops                         0.409                   
Bolinichthys_supralateralis                0.338              0.204
Borostomias_antarcticus                    0.356              0.283
Chauliodus_sloani                          0.456              0.499
Cyclothone_sp                              0.424              0.317
Diaphus_metoclampus                        0.385              0.223
Evermannella_balbo                         0.351              0.342
Gonostoma_elongatum                        0.308              0.308
Holtbyrnia_anomala                         0.414              0.189
Lampanyctus_ater                           0.386              0.171
Lampanyctus_macdonaldi                     0.326              0.258
Lestidiops_sphyrenoides                    0.504              0.205
Lobianchia_gemellarii                      0.313              0.216
Maulisia_mauli                             0.351              0.163
Maurolicus_muelleri                        0.500              0.217
Melanostomias_bartonbeani                  0.471              0.476
Notoscopelus_bolini                        0.416              0.163
Photostylus_pycnopterus                    0.495              0.278
Sagamichthys_schnakenbecki                 0.438              0.170
                            Bolinichthys_supralateralis Borostomias_antarcticus
Bathylagus_euryops                                                             
Bolinichthys_supralateralis                                                    
Borostomias_antarcticus                           0.328                        
Chauliodus_sloani                                 0.479                   0.401
Cyclothone_sp                                     0.314                   0.258
Diaphus_metoclampus                               0.217                   0.305
Evermannella_balbo                                0.404                   0.337
Gonostoma_elongatum                               0.328                   0.212
Holtbyrnia_anomala                                0.261                   0.352
Lampanyctus_ater                                  0.171                   0.188
Lampanyctus_macdonaldi                            0.241                   0.187
Lestidiops_sphyrenoides                           0.324                   0.359
Lobianchia_gemellarii                             0.187                   0.161
Maulisia_mauli                                    0.151                   0.217
Maurolicus_muelleri                               0.247                   0.317
Melanostomias_bartonbeani                         0.463                   0.255
Notoscopelus_bolini                               0.170                   0.233
Photostylus_pycnopterus                           0.316                   0.335
Sagamichthys_schnakenbecki                        0.176                   0.269
                            Chauliodus_sloani Cyclothone_sp Diaphus_metoclampus
Bathylagus_euryops                                                             
Bolinichthys_supralateralis                                                    
Borostomias_antarcticus                                                        
Chauliodus_sloani                                                              
Cyclothone_sp                           0.332                                  
Diaphus_metoclampus                     0.417         0.345                    
Evermannella_balbo                      0.257         0.335               0.347
Gonostoma_elongatum                     0.424         0.268               0.307
Holtbyrnia_anomala                      0.540         0.380               0.209
Lampanyctus_ater                        0.428         0.257               0.217
Lampanyctus_macdonaldi                  0.454         0.260               0.273
Lestidiops_sphyrenoides                 0.416         0.310               0.347
Lobianchia_gemellarii                   0.413         0.234               0.208
Maulisia_mauli                          0.509         0.301               0.176
Maurolicus_muelleri                     0.460         0.300               0.154
Melanostomias_bartonbeani               0.238         0.343               0.518
Notoscopelus_bolini                     0.449         0.272               0.177
Photostylus_pycnopterus                 0.343         0.306               0.216
Sagamichthys_schnakenbecki              0.458         0.328               0.121
                            Evermannella_balbo Gonostoma_elongatum
Bathylagus_euryops                                                
Bolinichthys_supralateralis                                       
Borostomias_antarcticus                                           
Chauliodus_sloani                                                 
Cyclothone_sp                                                     
Diaphus_metoclampus                                               
Evermannella_balbo                                                
Gonostoma_elongatum                      0.396                    
Holtbyrnia_anomala                       0.377               0.393
Lampanyctus_ater                         0.371               0.210
Lampanyctus_macdonaldi                   0.376               0.158
Lestidiops_sphyrenoides                  0.390               0.366
Lobianchia_gemellarii                    0.336               0.191
Maulisia_mauli                           0.417               0.247
Maurolicus_muelleri                      0.364               0.355
Melanostomias_bartonbeani                0.355               0.382
Notoscopelus_bolini                      0.376               0.270
Photostylus_pycnopterus                  0.359               0.293
Sagamichthys_schnakenbecki               0.367               0.312
                            Holtbyrnia_anomala Lampanyctus_ater
Bathylagus_euryops                                             
Bolinichthys_supralateralis                                    
Borostomias_antarcticus                                        
Chauliodus_sloani                                              
Cyclothone_sp                                                  
Diaphus_metoclampus                                            
Evermannella_balbo                                             
Gonostoma_elongatum                                            
Holtbyrnia_anomala                                             
Lampanyctus_ater                         0.248                 
Lampanyctus_macdonaldi                   0.300            0.124
Lestidiops_sphyrenoides                  0.270            0.238
Lobianchia_gemellarii                    0.261            0.096
Maulisia_mauli                           0.180            0.120
Maurolicus_muelleri                      0.193            0.205
Melanostomias_bartonbeani                0.527            0.394
Notoscopelus_bolini                      0.197            0.089
Photostylus_pycnopterus                  0.301            0.241
Sagamichthys_schnakenbecki               0.134            0.166
                            Lampanyctus_macdonaldi Lestidiops_sphyrenoides
Bathylagus_euryops                                                        
Bolinichthys_supralateralis                                               
Borostomias_antarcticus                                                   
Chauliodus_sloani                                                         
Cyclothone_sp                                                             
Diaphus_metoclampus                                                       
Evermannella_balbo                                                        
Gonostoma_elongatum                                                       
Holtbyrnia_anomala                                                        
Lampanyctus_ater                                                          
Lampanyctus_macdonaldi                                                    
Lestidiops_sphyrenoides                      0.356                        
Lobianchia_gemellarii                        0.096                   0.307
Maulisia_mauli                               0.155                   0.299
Maurolicus_muelleri                          0.285                   0.284
Melanostomias_bartonbeani                    0.394                   0.385
Notoscopelus_bolini                          0.191                   0.211
Photostylus_pycnopterus                      0.343                   0.238
Sagamichthys_schnakenbecki                   0.226                   0.298
                            Lobianchia_gemellarii Maulisia_mauli
Bathylagus_euryops                                              
Bolinichthys_supralateralis                                     
Borostomias_antarcticus                                         
Chauliodus_sloani                                               
Cyclothone_sp                                                   
Diaphus_metoclampus                                             
Evermannella_balbo                                              
Gonostoma_elongatum                                             
Holtbyrnia_anomala                                              
Lampanyctus_ater                                                
Lampanyctus_macdonaldi                                          
Lestidiops_sphyrenoides                                         
Lobianchia_gemellarii                                           
Maulisia_mauli                              0.131               
Maurolicus_muelleri                         0.226          0.193
Melanostomias_bartonbeani                   0.387          0.435
Notoscopelus_bolini                         0.117          0.132
Photostylus_pycnopterus                     0.294          0.293
Sagamichthys_schnakenbecki                  0.189          0.101
                            Maurolicus_muelleri Melanostomias_bartonbeani
Bathylagus_euryops                                                       
Bolinichthys_supralateralis                                              
Borostomias_antarcticus                                                  
Chauliodus_sloani                                                        
Cyclothone_sp                                                            
Diaphus_metoclampus                                                      
Evermannella_balbo                                                       
Gonostoma_elongatum                                                      
Holtbyrnia_anomala                                                       
Lampanyctus_ater                                                         
Lampanyctus_macdonaldi                                                   
Lestidiops_sphyrenoides                                                  
Lobianchia_gemellarii                                                    
Maulisia_mauli                                                           
Maurolicus_muelleri                                                      
Melanostomias_bartonbeani                 0.488                          
Notoscopelus_bolini                       0.191                     0.413
Photostylus_pycnopterus                   0.223                     0.408
Sagamichthys_schnakenbecki                0.134                     0.477
                            Notoscopelus_bolini Photostylus_pycnopterus
Bathylagus_euryops                                                     
Bolinichthys_supralateralis                                            
Borostomias_antarcticus                                                
Chauliodus_sloani                                                      
Cyclothone_sp                                                          
Diaphus_metoclampus                                                    
Evermannella_balbo                                                     
Gonostoma_elongatum                                                    
Holtbyrnia_anomala                                                     
Lampanyctus_ater                                                       
Lampanyctus_macdonaldi                                                 
Lestidiops_sphyrenoides                                                
Lobianchia_gemellarii                                                  
Maulisia_mauli                                                         
Maurolicus_muelleri                                                    
Melanostomias_bartonbeani                                              
Notoscopelus_bolini                                                    
Photostylus_pycnopterus                   0.262                        
Sagamichthys_schnakenbecki                0.157                   0.237</code></pre>
</div>
</div>
</section>
<section id="building-functional-spaces-and-chosing-the-best-one" class="level2">
<h2 class="anchored" data-anchor-id="building-functional-spaces-and-chosing-the-best-one">2.3 Building functional spaces and chosing the best one</h2>
<section id="computing-several-multimensional-functional-spaces-and-assessing-their-quality" class="level3">
<h3 class="anchored" data-anchor-id="computing-several-multimensional-functional-spaces-and-assessing-their-quality">2.3.1 Computing several multimensional functional spaces and assessing their quality</h3>
<p>-mFD evaluates the quality of PCoA-based multidimensional spaces according to the deviation between trait-based distances and distances in the functional space (extension of Maire et al.&nbsp;(2015) framework).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fspaces_quality_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">quality.fspaces</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_dist             =</span> sp_dist_fish,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxdim_pcoa         =</span> <span class="dv">10</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">deviation_weighting =</span> <span class="st">"absolute"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fdist_scaling       =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fdendro             =</span> <span class="st">"average"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Quality metrics of functional spaces ----</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(fspaces_quality_fish<span class="sc">$</span><span class="st">"quality_fspaces"</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               mad
pcoa_1d      0.141
pcoa_2d      0.079
pcoa_3d      0.048
pcoa_4d      0.031
pcoa_5d      0.022
pcoa_6d      0.014
pcoa_7d      0.011
pcoa_8d      0.012
pcoa_9d      0.013
pcoa_10d     0.015
tree_average 0.041</code></pre>
</div>
</div>
<p>The space with the best quality has the lowest quality metric. 5-D space good ?</p>
</section>
<section id="illustrating-the-quality-of-the-functional-spaces" class="level3">
<h3 class="anchored" data-anchor-id="illustrating-the-quality-of-the-functional-spaces">2.3.2 Illustrating the quality of the functional spaces</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mFD<span class="sc">::</span><span class="fu">quality.fspaces.plot</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fspaces_quality            =</span> fspaces_quality_fish,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">quality_metric             =</span> <span class="st">"mad"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fspaces_plot               =</span> <span class="fu">c</span>(<span class="st">"tree_average"</span>, <span class="st">"pcoa_2d"</span>, <span class="st">"pcoa_3d"</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"pcoa_4d"</span>, <span class="st">"pcoa_5d"</span>, <span class="st">"pcoa_6d"</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file                  =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_dist                 =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_dev                  =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_qdev                 =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient_deviation         =</span> <span class="fu">c</span>(<span class="at">neg =</span> <span class="st">"darkblue"</span>, <span class="at">nul =</span> <span class="st">"grey80"</span>, <span class="at">pos =</span> <span class="st">"darkred"</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient_deviation_quality =</span> <span class="fu">c</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_lab                      =</span> <span class="st">"Trait-based distance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/fspaces_quality_plot-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
<p>This function generates a figure with three panels (in rows) for each selected functional space (in columns). Each column represents a functional space, the value of the quality metric is written on the top of each column. The x-axis of all panels represents trait-based distances. The y-axis is different for each row:</p>
<ul>
<li>on the first (top) row, the y-axis represents species functional distances in the multidimensional space. Thus, the closer species are to the 1:1 line, the better distances in the functional space fit trait-based ones.</li>
<li>on the second row, the y-axis shows the raw deviation of species distances in the functional space compared to trait-based distances. Thus, the raw deviation reflects the distance to the horizontal line.</li>
<li>on the third row (bottom), the y-axis shows the absolute or squared deviation of the (“scaled”) distance in the functional space. It is the deviation that is taken into account for computing the quality metric.</li>
</ul>
</section>
<section id="testing-the-correlation-between-functional-axes-and-traits" class="level3">
<h3 class="anchored" data-anchor-id="testing-the-correlation-between-functional-axes-and-traits">2.3.3 Testing the correlation between functional axes and traits</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sp_faxes_coord_fish <span class="ot">&lt;-</span> fspaces_quality_fish<span class="sc">$</span><span class="st">"details_fspaces"</span><span class="sc">$</span><span class="st">"sp_pc_coord"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fish_tr_faxes &lt;- mFD::traits.faxes.cor(</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   sp_tr          = fish_traits, </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   sp_faxes_coord = sp_faxes_coord_fish[ , c("PC1", "PC2", "PC3", "PC4")])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="plotting-the-selected-functional-space-and-position-of-species" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-selected-functional-space-and-position-of-species">2.4 Plotting the selected functional space and position of species</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sp_faxes_coord_fish <span class="ot">&lt;-</span> fspaces_quality_fish<span class="sc">$</span><span class="st">"details_fspaces"</span><span class="sc">$</span><span class="st">"sp_pc_coord"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>big_plot <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">funct.space.plot</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_faxes_coord  =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes           =</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file       =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm        =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes     =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_ch         =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_vertices   =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm      =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input     =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>big_plot<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_functional_space-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="computing-and-plotting-beta-fd-indices" class="level1">
<h1>3. Computing and plotting beta FD indices</h1>
<ul>
<li>The function returns a list containing:</li>
<li>a dist object with beta indices values for each pair of assemblages:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>beta_fd_indices_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.fd.multidim</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">sp_faxes_coord   =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)],</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">asb_sp_occ       =</span> asb_sp_fish_occ,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">check_input      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_family      =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">details_returned =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Serial computing of convex hulls shaping assemblages with conv1

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |======================================================================| 100%
Serial computing of intersections between pairs of assemblages with inter_geom_coord

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(beta_fd_indices_fish<span class="sc">$</span><span class="st">"pairasb_fbd_indices"</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$jac_diss
                  Upper mesopelagic Bathypelagic Epipelagic
Bathypelagic              0.6482290                        
Epipelagic                0.9295111    0.9750274           
Lower mesopelagic         0.2136774    0.5526378  0.9441781

$jac_turn
                  Upper mesopelagic Bathypelagic   Epipelagic
Bathypelagic           0.000000e+00                          
Epipelagic             1.313043e-02 8.954645e-16             
Lower mesopelagic      6.780801e-16 0.000000e+00 2.387905e-15

$jac_nest
                  Upper mesopelagic Bathypelagic Epipelagic
Bathypelagic              0.6482290                        
Epipelagic                0.9163807    0.9750274           
Lower mesopelagic         0.2136774    0.5526378  0.9441781</code></pre>
</div>
</div>
<ul>
<li>a vector containing the FRic value for each assemblage retrieved through the details_beta list:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>beta_fd_indices_fish<span class="sc">$</span><span class="st">"details"</span><span class="sc">$</span><span class="st">"asb_FRic"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Upper mesopelagic      Bathypelagic        Epipelagic Lower mesopelagic 
       0.35177104        1.00000000        0.02497261        0.44736223 </code></pre>
</div>
</div>
<ul>
<li>a list of vectors containing names of species being vertices of the convex hull for each assemblage retrieved through the details_beta list:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>beta_fd_indices_fish<span class="sc">$</span><span class="st">"details"</span><span class="sc">$</span><span class="st">"asb_vertices"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`Upper mesopelagic`
 [1] "Lobianchia_gemellarii"      "Maurolicus_muelleri"       
 [3] "Melanostomias_bartonbeani"  "Lampanyctus_ater"          
 [5] "Maulisia_mauli"             "Evermannella_balbo"        
 [7] "Cyclothone_sp"              "Chauliodus_sloani"         
 [9] "Borostomias_antarcticus"    "Lestidiops_sphyrenoides"   
[11] "Sagamichthys_schnakenbecki"

$Bathypelagic
 [1] "Gonostoma_elongatum"         "Evermannella_balbo"         
 [3] "Maurolicus_muelleri"         "Lestidiops_sphyrenoides"    
 [5] "Photostylus_pycnopterus"     "Borostomias_antarcticus"    
 [7] "Sagamichthys_schnakenbecki"  "Lampanyctus_ater"           
 [9] "Cyclothone_sp"               "Bathylagus_euryops"         
[11] "Maulisia_mauli"              "Bolinichthys_supralateralis"
[13] "Notoscopelus_bolini"         "Melanostomias_bartonbeani"  
[15] "Lampanyctus_macdonaldi"      "Anoplogaster_cornuta"       
[17] "Chauliodus_sloani"           "Holtbyrnia_anomala"         

$Epipelagic
[1] "Lestidiops_sphyrenoides"   "Cyclothone_sp"            
[3] "Notoscopelus_bolini"       "Lobianchia_gemellarii"    
[5] "Lampanyctus_ater"          "Melanostomias_bartonbeani"
[7] "Maurolicus_muelleri"      

$`Lower mesopelagic`
 [1] "Evermannella_balbo"          "Melanostomias_bartonbeani"  
 [3] "Maurolicus_muelleri"         "Maulisia_mauli"             
 [5] "Cyclothone_sp"               "Bolinichthys_supralateralis"
 [7] "Lampanyctus_ater"            "Borostomias_antarcticus"    
 [9] "Notoscopelus_bolini"         "Gonostoma_elongatum"        
[11] "Chauliodus_sloani"           "Lestidiops_sphyrenoides"    
[13] "Sagamichthys_schnakenbecki" </code></pre>
</div>
</div>
<ul>
<li>overlap between convex hulls shaping each of the two species assemblages.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>beta_plot_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.multidim.plot</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_beta_fd_multidim =</span> beta_fd_indices_fish,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm             =</span> <span class="fu">c</span>(<span class="st">"Epipelagic"</span>, <span class="st">"Upper mesopelagic"</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_family             =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm              =</span> <span class="fu">c</span>(<span class="st">"Maurolicus_muelleri"</span>, <span class="st">"Notoscopelus_bolini"</span>, <span class="st">"Lampanyctus_ater"</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                   =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file               =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes             =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input             =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>beta_plot_fish<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_beta_FD_epi_up-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>beta_plot_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.multidim.plot</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_beta_fd_multidim =</span> beta_fd_indices_fish,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm             =</span> <span class="fu">c</span>(<span class="st">"Upper mesopelagic"</span>, <span class="st">"Lower mesopelagic"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_family             =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm              =</span> <span class="fu">c</span>(<span class="st">"Maulisia_mauli"</span>, <span class="st">"Evermannella_balbo"</span>, <span class="st">"Borostomias_antarcticus"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                   =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file               =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes             =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input             =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>beta_plot_fish<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_beta_FD_up_lw-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>beta_plot_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.multidim.plot</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_beta_fd_multidim =</span> beta_fd_indices_fish,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm             =</span> <span class="fu">c</span>(<span class="st">"Lower mesopelagic"</span>, <span class="st">"Bathypelagic"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_family             =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm              =</span> <span class="fu">c</span>(<span class="st">"Anoplogaster_cornuta"</span>, <span class="st">"Holtbyrnia_anomala"</span>, <span class="st">"Photostylus_pycnopterus"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                   =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file               =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes             =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input             =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>beta_plot_fish<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_beta_FD_lw_b-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
<section id="functional-rarity" class="level1">
<h1>4. Functional rarity</h1>
<section id="different-indices-of-functional-rarity" class="level2">
<h2 class="anchored" data-anchor-id="different-indices-of-functional-rarity">4.1 Different indices of functional rarity</h2>
<p><span style="color:#2596be;"><strong>Functional originality indices</strong></span>:</p>
<ul>
<li><p><strong>Functional distinctiveness</strong> is the mean of dissimilarity of the focal species to all the other species of the set of interest. It can be abundance-weighted if needed.</p></li>
<li><p><strong>Functional uniqueness</strong> is the smallest dissimilarity that exists between the focal species and the all other species in the set. It does not consider the abundance of any species.</p></li>
</ul>
<p><span style="color:#2596be;"><strong>Rarity indices</strong></span>:</p>
<ul>
<li><p><strong>Scarcity</strong> is proportional to the relative abundance of the species. It gets close to one when the species is (relatively) rare and close to 0 when its dominant</p></li>
<li><p><strong>Restrictedness</strong> is 1 minus the ratio of sites a species occupy over the total number of sites.</p></li>
</ul>
</section>
<section id="computing-functional-rarity" class="level2">
<h2 class="anchored" data-anchor-id="computing-functional-rarity">4.2.Computing functional rarity</h2>
<section id="functional-originality-at-regional-scale" class="level3">
<h3 class="anchored" data-anchor-id="functional-originality-at-regional-scale">4.2.1 Functional originality at regional scale</h3>
<ul>
<li>For the choice or dissimilarity matrix we can use the raw dissimilarity matrix computed directly on raw traits values among species:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sp_di <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">distinctiveness_global</span>(sp_dist_fish, <span class="at">di_name =</span> <span class="st">"distinctiveness"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(sp_di))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e62fe6a02ac467b3ed96" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e62fe6a02ac467b3ed96">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["Anoplogaster_cornuta","Bathylagus_euryops","Bolinichthys_supralateralis","Borostomias_antarcticus","Chauliodus_sloani","Cyclothone_sp","Diaphus_metoclampus","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Lampanyctus_ater","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Maulisia_mauli","Maurolicus_muelleri","Melanostomias_bartonbeani","Notoscopelus_bolini","Photostylus_pycnopterus","Sagamichthys_schnakenbecki"],[0.4022049984770705,0.2679220083116797,0.2799673432246437,0.2816544525973352,0.4196632661357991,0.3096739887363402,0.2717385635802042,0.3608751082379827,0.3014436407141283,0.3013744181206165,0.2273206217669616,0.263227282239539,0.3213788496613441,0.2295482377050696,0.2405508071894689,0.2807828576555086,0.4110371900377688,0.2360484227225557,0.3042008095593997,0.2504720848163838]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>species<\/th>\n      <th>distinctiveness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>Another option would be to compute a new functional dissimilarity matrix based on the selected functional axes. One advantage of the latter is that it already takes into account the correlation between traits (recompute regional functional distinctiveness based on the n selected functional axes. Because the space comes from a PCA, we can directly use euclidean distance):</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new_dissim <span class="ot">&lt;-</span> <span class="fu">dist</span>(sp_faxes_coord_fish[, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>sp_di_alt <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">distinctiveness_global</span>(new_dissim, <span class="at">di_name =</span> <span class="st">"alt_di"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#We can now compare both distinctiveness values.</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>sp_all_di <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_di, sp_di_alt, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp_all_di<span class="sc">$</span>distinctiveness, sp_all_di<span class="sc">$</span>alt_di)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/distinctiveness_n_axis-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(sp_all_di<span class="sc">$</span>distinctiveness, sp_all_di<span class="sc">$</span>alt_di)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  sp_all_di$distinctiveness and sp_all_di$alt_di
t = 16.068, df = 18, p-value = 4.058e-12
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.9164514 0.9870620
sample estimates:
      cor 
0.9668623 </code></pre>
</div>
</div>
<p>Both seems very correlated, so in our case using either one should be fine. However, it can be better to use dissimilarity based on a reduced number of well-defined axes because: (1) there are more interpretable thanks to the multivariate analysis, (2) the first one contain of the most information, (3) they explicitly take into account potentially strong correlations between provided traits. We’ll stick here with raw dissimilarity for the sake of simplicity</p>
<p>To compute uniqueness at regional scale we also need the regional level functional dissimilarity matrix with the uniqueness() function, and the site-species matrix:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sp_ui <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">uniqueness</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pres_matrix =</span> depth_fish_biomass,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>(sp_dist_fish)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(sp_ui<span class="sc">$</span>Ui, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        10%        20%        30%        40%        50%        60% 
0.08918683 0.09435914 0.09859580 0.11390689 0.13748593 0.15822912 0.16227449 
       70%        80%        90%       100% 
0.21551717 0.23547784 0.24215133 0.30799449 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(sp_ui))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dfde0c9c1eef5bb74873" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dfde0c9c1eef5bb74873">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],["Anoplogaster_cornuta","Bathylagus_euryops","Bolinichthys_supralateralis","Borostomias_antarcticus","Chauliodus_sloani","Cyclothone_sp","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Maulisia_mauli","Maurolicus_muelleri","Melanostomias_bartonbeani","Lampanyctus_ater","Photostylus_pycnopterus","Sagamichthys_schnakenbecki","Notoscopelus_bolini"],[0.3079944943291218,0.1625975312247552,0.1511398234166086,0.1609823011002499,0.2383873849818951,0.2335381350466273,0.2572070949254052,0.1582291231958843,0.1340724624335926,0.09573220402479143,0.2050247429360177,0.09565221629980204,0.1005048583664764,0.134009946682393,0.2383873849818951,0.08918683386983867,0.2225121171160887,0.1005048583664764,0.08918683386983867]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>species<\/th>\n      <th>Ui<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Based on these results we see that <em>Anoplogaster cornuta</em>, <em>Evermannella balbo</em>, and <em>Chauliodus sloani</em> are the most isolated fish in the functional space. Meaning that they have the most distant nearest neighbors.</p>
</section>
<section id="functional-originality-at-local-scale" class="level3">
<h3 class="anchored" data-anchor-id="functional-originality-at-local-scale">4.2.2 Functional originality at local scale</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>sp_local_di <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">distinctiveness</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  depth_fish_biomass, <span class="fu">as.matrix</span>(sp_dist_fish)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>sp_local_di[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  Anoplogaster_cornuta Bathylagus_euryops
Upper mesopelagic                   NA                 NA
Bathypelagic                 0.4222418          0.3144837
Epipelagic                          NA                 NA
Lower mesopelagic                   NA                 NA
                  Bolinichthys_supralateralis Borostomias_antarcticus
Upper mesopelagic                          NA               0.2575080
Bathypelagic                        0.3095523               0.2576447
Epipelagic                                 NA                      NA
Lower mesopelagic                   0.2830010               0.2850685
                  Chauliodus_sloani Cyclothone_sp Evermannella_balbo
Upper mesopelagic         0.3573761     0.3026306          0.3494591
Bathypelagic              0.3382178     0.2912187          0.3361591
Epipelagic                       NA     0.2878235                 NA
Lower mesopelagic         0.4036351     0.2985873          0.3558329
                  Gonostoma_elongatum Holtbyrnia_anomala Lampanyctus_macdonaldi
Upper mesopelagic                  NA                 NA                     NA
Bathypelagic                0.2678535          0.3744546              0.2583958
Epipelagic                         NA                 NA                     NA
Lower mesopelagic           0.3187773                 NA                     NA</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">dim</span>(sp_local_di), <span class="fu">dim</span>(depth_fish_biomass))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>To compute uniqueness at the site scale, we must use a more complex expression as it was not envisioned for local computation:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>depth_ui <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  depth_fish_biomass, <span class="dv">1</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(single_site, dist_m) {</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    single_site <span class="ot">=</span> single_site[single_site <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(single_site)]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    funrar<span class="sc">::</span><span class="fu">uniqueness</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(single_site)), dist_m)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">dist_m =</span> <span class="fu">as.matrix</span>(sp_dist_fish)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(depth_ui[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`Upper mesopelagic`
                      species         Ui
1     Borostomias_antarcticus 0.16098230
2           Chauliodus_sloani 0.23838738
3               Cyclothone_sp 0.23353814
4          Evermannella_balbo 0.25720709
5     Lestidiops_sphyrenoides 0.23789144
6       Lobianchia_gemellarii 0.09565222
7              Maulisia_mauli 0.10050486
8         Maurolicus_muelleri 0.13400995
9   Melanostomias_bartonbeani 0.23838738
10           Lampanyctus_ater 0.09565222
11 Sagamichthys_schnakenbecki 0.10050486</code></pre>
</div>
</div>
<p>As we had to manually build the function to compute the local uniqueness the results are strangely formatted.</p>
<p>We provide here a function that can help them to be more easily read:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>depth_ui <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(depth_ui), <span class="cf">function</span>(x) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  single_depth <span class="ot">=</span> depth_ui[[x]]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  single_depth<span class="sc">$</span>site <span class="ot">=</span> x</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(single_depth)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>depth_ui <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, depth_ui)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Then we can again look at the apple to see how its uniqueness varies across depths.</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(depth_ui, species <span class="sc">==</span> <span class="st">"Melanostomias_bartonbeani"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     species        Ui              site
9  Melanostomias_bartonbeani 0.2383874 Upper mesopelagic
26 Melanostomias_bartonbeani 0.2383874      Bathypelagic
35 Melanostomias_bartonbeani 0.3429078        Epipelagic
48 Melanostomias_bartonbeani 0.2383874 Lower mesopelagic</code></pre>
</div>
</div>
<p>4.3.3.Rarity indices</p>
<p><strong>scarcity</strong>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rel_weights <span class="ot">=</span> funrar<span class="sc">::</span><span class="fu">make_relative</span>(depth_fish_biomass)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>si <span class="ot">=</span>  funrar<span class="sc">::</span><span class="fu">scarcity</span>(rel_weights)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Anoplogaster_cornuta Bathylagus_euryops Bolinichthys_supralateralis
 Min.   :0.9936       Min.   :0.8411     Min.   :0.7750             
 1st Qu.:0.9936       1st Qu.:0.8411     1st Qu.:0.8303             
 Median :0.9936       Median :0.8411     Median :0.8856             
 Mean   :0.9936       Mean   :0.8411     Mean   :0.8856             
 3rd Qu.:0.9936       3rd Qu.:0.8411     3rd Qu.:0.9409             
 Max.   :0.9936       Max.   :0.8411     Max.   :0.9962             
 NA's   :3            NA's   :3          NA's   :2                  
 Borostomias_antarcticus Chauliodus_sloani Cyclothone_sp     
 Min.   :0.8473          Min.   :0.6822    Min.   :0.000004  
 1st Qu.:0.8928          1st Qu.:0.7000    1st Qu.:0.075606  
 Median :0.9383          Median :0.7178    Median :0.251335  
 Mean   :0.9166          Mean   :0.7800    Mean   :0.354920  
 3rd Qu.:0.9513          3rd Qu.:0.8289    3rd Qu.:0.530650  
 Max.   :0.9642          Max.   :0.9399    Max.   :0.917004  
 NA's   :1               NA's   :1                           
 Evermannella_balbo Gonostoma_elongatum Holtbyrnia_anomala
 Min.   :0.5546     Min.   :0.6401      Min.   :0.9867    
 1st Qu.:0.7009     1st Qu.:0.7278      1st Qu.:0.9867    
 Median :0.8473     Median :0.8156      Median :0.9867    
 Mean   :0.7995     Mean   :0.8156      Mean   :0.9867    
 3rd Qu.:0.9220     3rd Qu.:0.9033      3rd Qu.:0.9867    
 Max.   :0.9968     Max.   :0.9911      Max.   :0.9867    
 NA's   :1          NA's   :2           NA's   :3         
 Lampanyctus_macdonaldi Lestidiops_sphyrenoides Lobianchia_gemellarii
 Min.   :0.8672         Min.   :0.7711          Min.   :0.3134       
 1st Qu.:0.8672         1st Qu.:0.8222          1st Qu.:0.7281       
 Median :0.8672         Median :0.8798          Median :0.8723       
 Mean   :0.8672         Mean   :0.8822          Mean   :0.7568       
 3rd Qu.:0.8672         3rd Qu.:0.9399          3rd Qu.:0.9009       
 Max.   :0.8672         Max.   :0.9981          Max.   :0.9692       
 NA's   :3                                                           
 Maulisia_mauli   Maurolicus_muelleri Melanostomias_bartonbeani
 Min.   :0.9156   Min.   :0.02183     Min.   :0.09822          
 1st Qu.:0.9180   1st Qu.:0.07175     1st Qu.:0.60577          
 Median :0.9205   Median :0.15668     Median :0.86628          
 Mean   :0.9198   Mean   :0.32594     Mean   :0.70342          
 3rd Qu.:0.9219   3rd Qu.:0.41087     3rd Qu.:0.96393          
 Max.   :0.9234   Max.   :0.96857     Max.   :0.98290          
 NA's   :1                                                     
 Lampanyctus_ater Photostylus_pycnopterus Sagamichthys_schnakenbecki
 Min.   :0.4097   Min.   :0.9962          Min.   :0.7178            
 1st Qu.:0.5223   1st Qu.:0.9962          1st Qu.:0.7589            
 Median :0.7288   Median :0.9962          Median :0.8000            
 Mean   :0.7062   Mean   :0.9962          Mean   :0.8384            
 3rd Qu.:0.9127   3rd Qu.:0.9962          3rd Qu.:0.8987            
 Max.   :0.9576   Max.   :0.9962          Max.   :0.9974            
                  NA's   :3               NA's   :1                 
 Notoscopelus_bolini
 Min.   :0.1552     
 1st Qu.:0.5393     
 Median :0.9234     
 Mean   :0.6912     
 3rd Qu.:0.9592     
 Max.   :0.9949     
 NA's   :1          </code></pre>
</div>
</div>
<p>__ restrictiveness__:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ri <span class="ot">=</span> funrar<span class="sc">::</span><span class="fu">restrictedness</span>(depth_fish_biomass)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ri)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   species                Ri        
 Length:19          Min.   :0.0000  
 Class :character   1st Qu.:0.0000  
 Mode  :character   Median :0.2500  
                    Mean   :0.3289  
                    3rd Qu.:0.6250  
                    Max.   :0.7500  </code></pre>
</div>
</div>
</section>
</section>
<section id="plotting-functional-rarity" class="level2">
<h2 class="anchored" data-anchor-id="plotting-functional-rarity">4.3 Plotting functional rarity</h2>
<section id="plotting-functional-originality" class="level3">
<h3 class="anchored" data-anchor-id="plotting-functional-originality">4.3.1 Plotting functional originality</h3>
<p>option to be able to colour species according to their functional originality (and not use the ready-made functions in the mfd package)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a summary data.frame</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sp_faxes_coord_fish[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sp_coord_di_ui)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sp_coord_di_ui) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> sp_coord_di_ui[, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_coord_di_ui, sp_di, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_coord_di_ui, sp_ui, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>plot_reg_distinctiveness <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_coord_di_ui, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> distinctiveness), <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">high =</span> <span class="st">"#914568"</span>, <span class="at">low =</span> <span class="st">"#6BA1B9"</span>, <span class="st">"Functional</span><span class="sc">\n</span><span class="st">Distinctiveness"</span>)<span class="sc">+</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>plot_reg_uniqueness <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_coord_di_ui, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Ui), <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">high =</span> <span class="st">"#914568"</span>, <span class="at">low =</span> <span class="st">"#6BA1B9"</span>,<span class="st">"Functional</span><span class="sc">\n</span><span class="st">Uniqueness"</span>) <span class="sc">+</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(plot_reg_distinctiveness, plot_reg_uniqueness)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_si_ri-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
<ul>
<li><p>As was done with mFD to correlate the functional axes with species’ traits we can correlate functional distinctiveness to specific traits in order to see which traits are mainly driving distinctiveness.</p></li>
<li><p>Regarding local level functional originality indices, the visualization can be more difficult to grasp and depends highly on the question. Would you rather focus on visualizing the functional distinctiveness of one species across communities? Compare the distribution of functional distinctiveness values across communities?</p></li>
<li><p>One idea to keep in mind is that averaging functional distinctiveness per community is exactly equal to computing functional dispersion. Functional originality is computed on a species basis, so we should be aware that if we are rather interested by community properties than we can compute functional diversity metrics which are much more appropriate.</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>local_di_ap <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sp_local_di[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">11</span>)])</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>local_di_ap<span class="sc">$</span>depth <span class="ot">&lt;-</span> <span class="fu">rownames</span>(local_di_ap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-rarity" class="level3">
<h3 class="anchored" data-anchor-id="plotting-rarity">4.3.2. Plotting rarity</h3>
<ul>
<li><strong>Functional Distinctiveness</strong></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>sp_di_ri <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_di, ri, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>sp_di_ri_ui <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_di_ri, sp_ui, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>plot_dist_ri_reg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_di_ri, <span class="fu">aes</span>(distinctiveness, Ri)) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species)) <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Distinctiveness"</span>, <span class="at">y =</span> <span class="st">"Geographical Restrictedness"</span>) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>plot_dist_ri_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dist_ri_reg-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On this visualization we can clearly see that <em>Anoplogaster cornuta</em> is overall the most distinct species while being quite restricted in terms of depth. On the other hand, the two Myctophidae <em>Lampanyctus ater</em> and <em>Lobianchia_gemellarii</em> are the most functionally common and regionally widespread species (low restrictedness).</p>
<ul>
<li><strong>Functional Uniqueness</strong></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_ui_ri_reg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_di_ri_ui, <span class="fu">aes</span>(Ui, Ri)) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species)) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Uniqueness"</span>, <span class="at">y =</span> <span class="st">"Geographical Restrictedness"</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plot_ui_ri_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_ui_ri_reg-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>plot local scale measurements:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sp_local_di_df <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">matrix_to_stack</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  sp_local_di, <span class="at">value_col =</span> <span class="st">"local_di"</span>, <span class="at">row_to_col =</span> <span class="st">"basket"</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_to_col =</span> <span class="st">"species"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>sp_local_si_df <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">matrix_to_stack</span>(</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  si, <span class="at">value_col =</span> <span class="st">"local_si"</span>, <span class="at">row_to_col =</span> <span class="st">"basket"</span>, <span class="at">col_to_col =</span> <span class="st">"species"</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>sp_local_di_si <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  sp_local_di_df, sp_local_si_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"basket"</span>, <span class="st">"species"</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sp_local_di_si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        basket                     species  local_di     local_si
1 Bathypelagic        Anoplogaster_cornuta 0.4222418 9.936334e-01
2 Bathypelagic          Bathylagus_euryops 0.3144837 8.410660e-01
3 Bathypelagic Bolinichthys_supralateralis 0.3095523 9.961752e-01
4 Bathypelagic     Borostomias_antarcticus 0.2576447 9.642494e-01
5 Bathypelagic           Chauliodus_sloani 0.3382178 9.399271e-01
6 Bathypelagic               Cyclothone_sp 0.2912187 3.996095e-06</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plot_local_di_si <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_local_di_si, <span class="fu">aes</span>(local_di, local_si)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Distinctiveness"</span>, <span class="at">y =</span> <span class="st">"Scarcity"</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>plot_local_di_si</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_local_di_si-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>