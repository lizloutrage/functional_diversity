<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liz Loutrage">

<title>index</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="index_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="index_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="index_files/libs/datatables-binding-0.30/datatables.js"></script>
<script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="index_files/libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="index_files/libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="index_files/libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="index_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="index_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#questions" id="toc-questions" class="nav-link active" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data preparation</a>
  <ul class="collapse">
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing data</a>
  <ul class="collapse">
  <li><a href="#data-imputation" id="toc-data-imputation" class="nav-link" data-scroll-target="#data-imputation">data imputation</a></li>
  </ul></li>
  <li><a href="#species-traits" id="toc-species-traits" class="nav-link" data-scroll-target="#species-traits">Species * traits</a>
  <ul class="collapse">
  <li><a href="#calctulate-functional-traits" id="toc-calctulate-functional-traits" class="nav-link" data-scroll-target="#calctulate-functional-traits">calctulate functional traits</a></li>
  </ul></li>
  <li><a href="#species-assemblages-matrix" id="toc-species-assemblages-matrix" class="nav-link" data-scroll-target="#species-assemblages-matrix">Species * assemblages matrix</a>
  <ul class="collapse">
  <li><a href="#species-depth-distribution" id="toc-species-depth-distribution" class="nav-link" data-scroll-target="#species-depth-distribution">Species depth distribution</a></li>
  </ul></li>
  <li><a href="#traits-types" id="toc-traits-types" class="nav-link" data-scroll-target="#traits-types">Traits types</a></li>
  </ul></li>
  <li><a href="#cwm" id="toc-cwm" class="nav-link" data-scroll-target="#cwm">1. CWM</a></li>
  <li><a href="#build-a-functional-space-using-the-mfd-package" id="toc-build-a-functional-space-using-the-mfd-package" class="nav-link" data-scroll-target="#build-a-functional-space-using-the-mfd-package">2. Build a functional space using the mFD package</a>
  <ul class="collapse">
  <li><a href="#compute-data-summaries" id="toc-compute-data-summaries" class="nav-link" data-scroll-target="#compute-data-summaries">2.1 Compute data summaries</a></li>
  <li><a href="#computing-distances-between-species-based-on-functional-traits" id="toc-computing-distances-between-species-based-on-functional-traits" class="nav-link" data-scroll-target="#computing-distances-between-species-based-on-functional-traits">2.2 Computing distances between species based on functional traits</a></li>
  <li><a href="#building-functional-spaces-and-chosing-the-best-one" id="toc-building-functional-spaces-and-chosing-the-best-one" class="nav-link" data-scroll-target="#building-functional-spaces-and-chosing-the-best-one">2.3 Building functional spaces and chosing the best one</a>
  <ul class="collapse">
  <li><a href="#computing-several-multimensional-functional-spaces-and-assessing-their-quality" id="toc-computing-several-multimensional-functional-spaces-and-assessing-their-quality" class="nav-link" data-scroll-target="#computing-several-multimensional-functional-spaces-and-assessing-their-quality">2.3.1 Computing several multimensional functional spaces and assessing their quality</a></li>
  <li><a href="#illustrating-the-quality-of-the-functional-spaces" id="toc-illustrating-the-quality-of-the-functional-spaces" class="nav-link" data-scroll-target="#illustrating-the-quality-of-the-functional-spaces">2.3.2 Illustrating the quality of the functional spaces</a></li>
  <li><a href="#testing-the-correlation-between-functional-axes-and-traits" id="toc-testing-the-correlation-between-functional-axes-and-traits" class="nav-link" data-scroll-target="#testing-the-correlation-between-functional-axes-and-traits">2.3.3 Testing the correlation between functional axes and traits</a></li>
  </ul></li>
  <li><a href="#plotting-the-selected-functional-space-and-position-of-species" id="toc-plotting-the-selected-functional-space-and-position-of-species" class="nav-link" data-scroll-target="#plotting-the-selected-functional-space-and-position-of-species">2.4 Plotting the selected functional space and position of species</a></li>
  </ul></li>
  <li><a href="#computing-and-plotting-fd-indices-using-the-mfd-package" id="toc-computing-and-plotting-fd-indices-using-the-mfd-package" class="nav-link" data-scroll-target="#computing-and-plotting-fd-indices-using-the-mfd-package">3. Computing and plotting FD indices using the mFD package</a>
  <ul class="collapse">
  <li><a href="#computing-and-plotting-alpha-fd-indices" id="toc-computing-and-plotting-alpha-fd-indices" class="nav-link" data-scroll-target="#computing-and-plotting-alpha-fd-indices">3.1 Computing and plotting alpha FD indices</a>
  <ul class="collapse">
  <li><a href="#fric-functional-richness" id="toc-fric-functional-richness" class="nav-link" data-scroll-target="#fric-functional-richness"><strong>FRic Functional Richness</strong></a></li>
  <li><a href="#fdiv-functional-divergence" id="toc-fdiv-functional-divergence" class="nav-link" data-scroll-target="#fdiv-functional-divergence"><strong>FDiv Functional Divergence</strong></a></li>
  <li><a href="#fspe-functional-specialization" id="toc-fspe-functional-specialization" class="nav-link" data-scroll-target="#fspe-functional-specialization"><strong>FSpe Functional Specialization</strong></a></li>
  <li><a href="#fdis-functional-dispersion" id="toc-fdis-functional-dispersion" class="nav-link" data-scroll-target="#fdis-functional-dispersion"><strong>FDis Functional Dispersion</strong></a></li>
  <li><a href="#fide-functional-identity" id="toc-fide-functional-identity" class="nav-link" data-scroll-target="#fide-functional-identity"><strong>FIde Functional Identity</strong></a></li>
  </ul></li>
  <li><a href="#computing-and-plotting-beta-fd-indices" id="toc-computing-and-plotting-beta-fd-indices" class="nav-link" data-scroll-target="#computing-and-plotting-beta-fd-indices">3.2.Computing and plotting beta FD indices</a></li>
  </ul></li>
  <li><a href="#functional-rarity" id="toc-functional-rarity" class="nav-link" data-scroll-target="#functional-rarity">4. Functional rarity</a>
  <ul class="collapse">
  <li><a href="#different-indices-of-functional-rarity" id="toc-different-indices-of-functional-rarity" class="nav-link" data-scroll-target="#different-indices-of-functional-rarity">4.1 Different indices of functional rarity</a></li>
  <li><a href="#computing-functional-rarity" id="toc-computing-functional-rarity" class="nav-link" data-scroll-target="#computing-functional-rarity">4.2.Computing functional rarity</a>
  <ul class="collapse">
  <li><a href="#functional-originality-at-regional-scale" id="toc-functional-originality-at-regional-scale" class="nav-link" data-scroll-target="#functional-originality-at-regional-scale">4.2.1 Functional originality at regional scale</a></li>
  <li><a href="#functional-originality-at-local-scale" id="toc-functional-originality-at-local-scale" class="nav-link" data-scroll-target="#functional-originality-at-local-scale">4.2.2 Functional originality at local scale</a></li>
  </ul></li>
  <li><a href="#plotting-functional-rarity" id="toc-plotting-functional-rarity" class="nav-link" data-scroll-target="#plotting-functional-rarity">4.3 Plotting functional rarity</a>
  <ul class="collapse">
  <li><a href="#plotting-functional-originality" id="toc-plotting-functional-originality" class="nav-link" data-scroll-target="#plotting-functional-originality">4.3.1 Plotting functional originality</a></li>
  <li><a href="#plotting-rarity" id="toc-plotting-rarity" class="nav-link" data-scroll-target="#plotting-rarity">4.3.2. Plotting rarity</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">index</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Liz Loutrage </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="questions" class="level1">
<h1>Questions</h1>
<ul>
<li><p><span style="color:#2596be;"><strong>β-functional diversity</strong></span>: calcul des indices de dissimilarité entre les assemblages (profondeurs) : profondeur = filtre environnemental ?</p>
<ul>
<li><p><em>Turnover</em>: élevé s’il n’y a pas de combinaison de traits partagés entre les assemblages</p></li>
<li><p><em>Nestedness component</em>: élevé si un assemblage abrite un petit sous-ensemble des stratégies fonctionnelles présentes dans l’autre</p></li>
</ul></li>
<li><p><span style="color:#2596be;"><strong>Functional rarity</strong></span>:</p>
<ul>
<li>Différencier échelle locale et régionale ?</li>
<li>inclure abondance/biomasse ?</li>
<li>y a t-il beaucoup d’espèces avec des combinaisons de traits uniques ?</li>
<li>y a en t-il plus en profondeur ?</li>
<li>les espèces fonctionnellement rares ont t-elles une distribution plus restreinte ?</li>
</ul></li>
</ul>
<p><strong>Point méthodo</strong>:</p>
<ul>
<li>exclure sp avec beaucoup NA pour certains traits ?</li>
<li>pondérer le poids de certains triats dans les analyses? (beaucoup de traits catégoriels qui peuvent artificiellement augmenter la diversité fonctionnelle)</li>
<li>besoin de transformer les données de traits distribuées de façon non-normale ?</li>
<li>Ajouter données profondeur 2022</li>
</ul>
</section>
<section id="data-preparation" class="level1">
<h1>Data preparation</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>morphometric_data <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"morphometric_data.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>morpho_data <span class="ot">&lt;-</span> morphometric_data <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(variable_abbreviation, variable_unit)) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">row_to_names</span>(<span class="at">row_number =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">rownames&lt;-</span><span class="st">`</span>(<span class="cn">NULL</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># delete for now (n=1)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">!=</span> <span class="st">"Diaphus_sp"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># replace empty value by NA </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>morpho_data[morpho_data <span class="sc">==</span><span class="st">""</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric variables</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>morpho_data[, <span class="dv">4</span><span class="sc">:</span><span class="dv">23</span>] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(morpho_data[, <span class="dv">4</span><span class="sc">:</span><span class="dv">23</span>], as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Data summary</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>morpho_data_summary <span class="ot">&lt;-</span>morpho_data <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(species)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(morpho_data_summary))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f5f7983a26c83e46ab44" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f5f7983a26c83e46ab44">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42"],["Anoplogaster_cornuta","Arctozenus_risso","Argyropelecus_hemigymnus","Argyropelecus_olfersii","Bathylagus_euryops","Benthosema_glaciale","Bolinichthys_supralateralis","Borostomias_antarcticus","Ceratoscopelus_maderensis","Chauliodus_sloani","Cyclothone_sp","Derichthys_serpentinus","Diaphus_metopoclampus","Eurypharynx_pelecanoides","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Holtbyrnia_macrops","Lampanyctus_ater","Lampanyctus_crocodilus","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Malacosteus_niger","Maulisia_argipalla","Maulisia_mauli","Maulisia_microlepis","Maurolicus_muelleri","Melanostigma_atlanticum","Melanostomias_bartonbeani","Myctophum_punctatum","Normichthys_operosus","Notoscopelus_bolini","Notoscopelus_kroyeri","Paralepis_coregonoides","Photostylus_pycnopterus","Sagamichthys_schnakenbecki","Searsia_koefoedi","Serrivomer_beanii","Sigmops_bathyphilus","Stomias_boa","Xenodermichthys_copei"],[3,30,17,37,19,20,11,14,30,12,12,7,4,6,4,3,3,9,22,39,21,7,22,5,5,11,4,11,20,9,25,38,20,36,19,8,9,36,30,20,26,38]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>species<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="missing-data" class="level2">
<h2 class="anchored" data-anchor-id="missing-data">Missing data</h2>
<p>The operculum width was the variable with the highest number of missing data (n = 30). This represents 4% of the data</p>
<p><strong>2 species with only NAs for an entire trait:</strong></p>
<ul>
<li><em>Eurpharynx pelecanoides</em> : 7 traits</li>
<li><em>Melanostigma atlanticum</em> : 2 traits</li>
</ul>
<div class="cell">

</div>
<section id="data-imputation" class="level3">
<h3 class="anchored" data-anchor-id="data-imputation">data imputation</h3>
<ul>
<li>mice algorithm: n imputation = 5, n iterations = 50</li>
<li>plot comparaison for Operculum Width</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select numeric variables for imputation </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>original_data <span class="ot">&lt;-</span> morpho_data <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>imputation <span class="ot">&lt;-</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  mice<span class="sc">::</span><span class="fu">mice</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    original_data,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">m =</span> <span class="dv">5</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxit =</span> <span class="dv">50</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">printFlag =</span> F</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>imputed_data <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">complete</span>(imputation)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">species =</span> original_data<span class="sc">$</span>species,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">standard_length =</span> original_data<span class="sc">$</span>standard_length,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Original =</span> original_data<span class="sc">$</span>operculum_width,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Imputed =</span> imputed_data<span class="sc">$</span>operculum_width) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species, standard_length)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(standard_length, Imputed, <span class="at">col =</span> <span class="fu">is.na</span>(Original))) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>species, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Imputed?"</span>) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey60"</span>, <span class="st">"firebrick2"</span>)) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/imputation_data-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
<p><strong>Measures density distribution</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>density_plot <span class="ot">&lt;-</span> imputed_data  <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(individual_code, station, weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span>species, <span class="at">names_to =</span> <span class="st">"traits"</span>, <span class="at">values_to =</span> <span class="st">"values"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(density_plot , <span class="fu">aes</span>(values)) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"darkgrey"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"lightgray"</span>) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> traits, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/density_plot_traits-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
</section>
<section id="species-traits" class="level2">
<h2 class="anchored" data-anchor-id="species-traits">Species * traits</h2>
<section id="calctulate-functional-traits" class="level3">
<h3 class="anchored" data-anchor-id="calctulate-functional-traits">calctulate functional traits</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate functional numeric traits</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>original_dataeric <span class="ot">&lt;-</span> imputed_data <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>individual_code) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">eye_size =</span> eye_diameter <span class="sc">/</span> head_depth,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">orbital_length =</span> eye_diameter <span class="sc">/</span> standard_length,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">oral_gap_surface =</span> mouth_width <span class="sc">*</span> mouth_depth <span class="sc">/</span> body_width <span class="sc">*</span> body_depth,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">oral_gape_shape =</span> mouth_depth <span class="sc">/</span> mouth_width,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">oral_gape_position =</span> distance_upper_jaws_bottom_head <span class="sc">/</span> head_depth,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_jaw_length =</span> lower_jaw_length <span class="sc">/</span> standard_length,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">head_length =</span> head_length <span class="sc">/</span> standard_length,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_depth =</span> body_depth <span class="sc">/</span> standard_length,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pectoral_fin_position =</span> distance_pectoral_bottom_body <span class="sc">/</span> body_depth_pectoral_insertion,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pectoral_fin_insertion =</span> prepectoral_length <span class="sc">/</span> standard_length,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">transversal_shape =</span> body_depth <span class="sc">/</span> body_width,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">dorsal_fin_insertion =</span> predorsal_length <span class="sc">/</span> standard_length,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">eye_position =</span> eye_height <span class="sc">/</span> head_depth,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">operculum_volume =</span> operculum_depth <span class="sc">/</span> operculum_width</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    species,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    eye_size,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    orbital_length,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    oral_gap_surface,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    oral_gape_shape,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    oral_gape_position,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    lower_jaw_length,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    operculum_width,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    head_length,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    body_depth,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    pectoral_fin_position,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    pectoral_fin_insertion,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    transversal_shape,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    caudal_peduncle_min_depth,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    dorsal_fin_insertion,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    eye_position,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    operculum_volume</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical traits for species without NA</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>cat_morpho <span class="ot">&lt;-</span> morpho_data <span class="sc">%&gt;%</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    species,</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    photophores_ventral_position ,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    gland_head,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    chin_barbel,</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    front_barbel,</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    small_teeth,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    large_teeth,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    fang_teeth,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    retractile_teeth,</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    internal_teeth,</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    gill_raker_types,</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    oral_gape_axis</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="co"># combined the two data frames</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>fish_traits <span class="ot">&lt;-</span> original_dataeric <span class="sc">%&gt;%</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(cat_morpho, <span class="at">by =</span> <span class="st">"species"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"species"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign trait type </span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.factor for qualitative traits</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.factor)<span class="sc">%&gt;%</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.ordered for ordered variables</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"gill_raker_types"</span>, <span class="st">"oral_gape_axis"</span>), as.ordered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Display the table ----</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(fish_traits))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-597ddf1a30dba8cd2e1b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-597ddf1a30dba8cd2e1b">{"x":{"filter":"none","vertical":false,"data":[["Anoplogaster_cornuta","Arctozenus_risso","Argyropelecus_hemigymnus","Argyropelecus_olfersii","Bathylagus_euryops","Benthosema_glaciale","Bolinichthys_supralateralis","Borostomias_antarcticus","Ceratoscopelus_maderensis","Chauliodus_sloani","Cyclothone_sp","Derichthys_serpentinus","Diaphus_metopoclampus","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Holtbyrnia_macrops","Lampanyctus_ater","Lampanyctus_crocodilus","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Malacosteus_niger","Maulisia_argipalla","Maulisia_mauli","Maulisia_microlepis","Maurolicus_muelleri","Melanostigma_atlanticum","Melanostomias_bartonbeani","Myctophum_punctatum","Normichthys_operosus","Notoscopelus_bolini","Notoscopelus_kroyeri","Paralepis_coregonoides","Photostylus_pycnopterus","Sagamichthys_schnakenbecki","Searsia_koefoedi","Serrivomer_beanii","Sigmops_bathyphilus","Stomias_boa","Xenodermichthys_copei"],[0.1870635427569378,0.6731215725922228,0.2528378924337218,0.2466185816292626,0.8073379156515913,0.553876225297698,0.6943542959568116,0.3918502902611463,0.61660846298933,0.3236216278441371,0.2896732995527421,0.7087200272405964,0.3806762185788406,0.4619095739058715,0.2627730950311468,0.7001620679316158,0.5861245029650884,0.5876906171451259,0.4605188017400862,0.4635401519874494,0.6379293967644859,0.4655204987772433,0.5686707446196964,0.5560047681071145,0.5436602586272192,0.4040027222573614,0.5366700102175092,0.5653194882201393,0.3404604909527202,0.5810276131287075,0.5877979401415817,0.58721677071155,0.5177971164068327,0.6557709453691855,0.3160340663331095,0.6531117613886723,0.5695641783784532,0.4097905992320632,0.3439623137409401,0.3246954087960091,0.653061224489796],[0.06513101563336203,0.03939043442921152,0.1103521526110715,0.1195337463229555,0.09733151619827526,0.09708002840620254,0.1002020784107539,0.0454502028499367,0.09456299480839496,0.03195944404217845,0.01820101324427989,0.01870641840179216,0.08672361809853502,0.06111392066224541,0.02365859567134613,0.107319044568802,0.09736638359612411,0.04953860514578357,0.04783772722762789,0.05324648475404745,0.03316666671153076,0.06137020103787766,0.0589832944995062,0.08848446584142593,0.0843550572708857,0.05808421042835739,0.0978961923388425,0.04280718124696028,0.02667037338846572,0.09235056814949912,0.105830132758109,0.06117253100231441,0.06286434018346203,0.05113309818745389,0.03048020374468671,0.08748603143506498,0.07967153949171366,0.007796575563762054,0.03401701434877021,0.02147373395945686,0.08897126969416125],[5083.202557222812,136.2152258622217,531.9137931071798,3042.322434320248,215.6744532820656,288.0952119082589,857.141772877457,2308.803855788343,281.2684201772519,1427.556961259949,442.8885203133374,102.2063575036608,496.3447641966349,746.3340129817943,6250.383835528853,854.060712338905,870.8481183231795,1516.361659863597,1550.595807548067,2223.938773657847,188.2579254995042,1226.901459954854,4216.396258458542,3465.852896151474,2055.911596674011,1384.771960858673,186.8514118522354,78.39976364627458,2537.245636289088,234.4223020823153,487.8793839205218,486.4451319733718,256.9243753109185,214.935335971926,80.09634693327251,822.5028358194945,550.0183144490258,121.0450061746473,4544.83974684605,733.3108496619434,250.3885057471265],[0.5910077137393964,2.701565369207982,1.382073522952367,0.9925153727538065,1.208429987743106,1.157723276407389,1.145308631944953,0.9549389452177165,1.995029714652799,2.198671222745045,2.449443009756685,1.689339435970036,0.9219855888959767,1.283292920158411,0.6068674018540213,1.283755231731155,1.246595443731965,1.144873224338048,1.276737860165135,1.162473804130551,2.223446422230094,1.100038150697565,0.8484726822993502,1.230101510957001,1.163701414828532,1.248535562855231,1.285170782096033,1.345688706965169,1.398821013856888,1.335620964108464,1.17547985904566,1.278747111079255,1.596452820078978,1.142638330612098,1.080061200669548,1.268934248354,1.096024427654899,0.5320584499681953,1.023028473395861,0.7082732997529833,1.752941176470588],[0.3951426840833095,0.6956161275567915,0.5404276289037069,0.7385898286347672,0.3502518371432042,0.3324025605583356,0.3380289556040331,0.4826993703447641,0.5595395778352831,0.7068627312794583,0.7937932689673789,0.492756633741221,0.3452486634420606,0.5829657156202231,0.4721898773185077,0.4712003973315194,0.3956514300993943,0.5680439070562933,0.7716613657494861,0.5744746730161431,0.5520998821851169,0.5212153959103951,0.3530711561087431,0.4631356481458706,0.3738738564459647,0.2036324254692755,0.5855853143839959,0.4857260963559027,0.6176663797525285,0.5678597742789305,0.556466751857582,0.4896021576606608,0.6177490372101652,0.4245107644843942,0.5624538104272562,0.361697362365493,0.5212244711908143,0.586629915236263,0.6490690083932986,0.7690740917957182,0.6394557823129252],[0.2861375317012913,0.1199066289068907,0.2514373364077059,0.266959472951216,0.07467819295892282,0.1884618356794901,0.19638076001865,0.198414842989372,0.2124063307567828,0.1144114643871464,0.2040581908463124,0.04491240788019163,0.1867292921905659,0.1634947940484265,0.1777783246347302,0.2092942077891755,0.2069838979262741,0.1973450981018806,0.210637486787245,0.2048825282290511,0.1027761390567869,0.2223712374577787,0.2544654948963843,0.2078438651875588,0.2120154019923103,0.1744403226406842,0.166670163223075,0.03814429068386168,0.1234687560304594,0.1566457249526299,0.1804848574435944,0.2008815666871479,0.197832221769231,0.1330213734139315,0.08475918421735412,0.1571232489521016,0.1366886549021795,0.08568386712504511,0.2267422887328622,0.09993380308826154,0.1139944392956441],[20.92,5.520333333333333,5.364705882352941,17.14486486486486,8.536315789473685,4.7555,12.47272727272727,15.79642857142857,5.523,9.454166666666666,7.475833333333333,4.758571428571429,6.3725,9.282500000000001,27.92,9.563333333333333,9.283333333333333,18.38136363636364,20.32410256410256,25.00333333333333,4.607142857142858,15.45818181818182,19.028,15.524,15.73,21.49,3.591818181818182,4.033,18.11777777777778,5.6196,9.430263157894737,9.629,6.779722222222222,4.898421052631579,6.5525,11.76,9.186666666666667,6.952666666666667,18.1015,6.292692307692308,19.9],[0.3471179569492232,0.2282622445820382,0.3034423890185704,0.308301242626706,0.2204700849878184,0.2577329098405489,0.2949444282485461,0.2219516612342632,0.3106831287972612,0.1353122370036637,0.2203047019193976,0.09229259278317947,0.2573417157046858,0.2169720130174164,0.208131053502031,0.3736914296278676,0.3084118074275706,0.2268293066821225,0.2617421786031248,0.2544000525765622,0.179483203158696,0.2690716828129346,0.2291135730880142,0.3581617707887102,0.3386367195769682,0.2602094930995654,0.2861583530888247,0.1289222320266107,0.1414616221329245,0.2434873975369473,0.3036775056329284,0.2484099358389354,0.2638957745998514,0.2491930232735534,0.1610794295053864,0.3035521067765809,0.2480447612095185,0.153233449096655,0.2463809400095261,0.1067771817341839,0.2344763670064875],[0.496765317595603,0.07231486748096279,0.5465676366743593,0.6527711514828205,0.1769713362911839,0.227186906305348,0.23575289155312,0.1471579276088384,0.1957057378562352,0.1139788839951372,0.1385564389886054,0.06475552609724118,0.2868922794103201,0.1854842390181648,0.1439966534398835,0.1995718556257012,0.1884279714218087,0.1634270563148341,0.174943368578538,0.1791292477891186,0.07016698379208147,0.2389029851391781,0.1846729123532705,0.2190923414047283,0.2006259493110997,0.2145214178694734,0.2284769602774343,0.08730489814688717,0.1281404978381019,0.2159343939861771,0.2184135875848383,0.1977431521215698,0.1921466687105275,0.09127720302297426,0.148949033138653,0.1648207240422557,0.2093720644298593,0.02676997296275347,0.1460846094753337,0.08181017986974991,0.1594068582020389],[0.327552178795381,0.2785452832292826,0.2307451284370966,0.2471710436456569,0.1987584730572414,0.4427266302964014,0.4605590043104663,0.1754328409583324,0.4771988618173915,0.289631998528789,0.1992742880547905,0.6600484532653362,0.2369353691925481,0.215888746321026,0.2073022595505449,0.2511962839831692,0.2467697101111054,0.3008188712564941,0.3780301606138066,0.1934391114778709,0.3583607039010895,0.2710821884027898,0.2070338218789051,0.1986434877697646,0.1907795219830297,0.1746990027397655,0.2251067492779084,0.3277490877358783,0.2233648323381441,0.4727531669301591,0.1841559512741846,0.2851868407331372,0.254490059280657,0.2229812001799436,0.4749769701497314,0.2331359005083858,0.2012247420149917,1,0.1973392223033529,0.1824120299750198,0.2203389830508475],[0.4003208996368177,0.2358202027404649,0.2779352032788916,0.2589592489665474,0.2573592617891224,0.2999602281286219,0.3283279074114032,0.2369008386437003,0.3413655289922946,0.1525109091904405,0.2296622405613443,0.1305046806357046,0.3475487347397182,0.234931461549684,0.2185105436064756,0.3836208813775061,0.3557612665211258,0.2575050471048759,0.2912274335906986,0.3991766831105948,0.1873220233715019,0.2905759860794116,0.1740874348298388,0.3692829665519732,0.3636636301971131,0.3343165173045963,0.2720666504252247,0.1519023270802228,0.1596798610655336,0.278532769448776,0.3277484293204377,0.2755915950773311,0.2868597770959138,0.2654937591570808,0.1830307523791412,0.3646360696731977,0.2602312413080092,1.912272743928823e-05,0.2852113862556448,0.1154570911731925,0.2391102873030584],[0.0371234059465991,0.01435870746028057,0.2549015223177563,0.1236266109740932,0.03231957651138185,0.09109791643347125,0.01988857958867888,0.03631916674726406,0.0314179790498654,0.01525793056447875,0.07135857193615111,0.01046142821823197,0.06090709882905589,0.0330170205426,0.01553375842430409,0.06429066383512382,0.04055065658457224,0.02463758734428551,0.01985425410804219,0.01871587454424042,0.01805418174713717,0.03025781637891173,0.02411855326084547,0.07493646258320825,0.03196526524002068,0.01480309413827949,0.1787182752269798,0.04130241912511247,0.01959986641736065,0.03254080223555961,0.01754916162030041,0.02763011114739326,0.02667208329968006,0.06703510034705321,0.02971955680387246,0.04254465702825964,0.01793523328064347,0.003317401467047132,0.08468757530738309,0.01107452305916778,0.0183226273795447],[10.45666666666667,3.639666666666667,3.425882352941176,5.975405405405406,6.301578947368421,3.3485,10.79727272727273,5.527142857142857,5.455333333333334,6.194166666666667,2.8375,2.242857142857143,5.945,6.265,12.76,4.013333333333334,6.078888888888889,8.561818181818182,11.33205128205128,13.30904761904762,2.92,8.897727272727273,8.033999999999999,5.81,7.612727272727272,18.175,2.204545454545455,1.3475,4.792222222222223,4.2856,8.535,6.7935,7.134722222222222,2.601052631578948,3.58375,5.828888888888889,10.18444444444444,1.211666666666667,3.299,3.472692307692308,5],[0.4441498752678317,0.6624057564359084,0.3558469543404688,0.3318952397764631,0.4615595496347744,0.4676150398984861,0.4469769590756064,0.5798280726541963,0.4979362376932329,0.2551650456937953,0.5434318108133503,0.3116459625644058,0.4041028771788586,0.4314272231538535,0.5671939001428983,0.6326973503856025,0.6361420651390463,0.4410062335674381,0.4528052962800324,0.4509057936924641,0.5980112926718268,0.4076621012576387,0.8268335886150313,0.6409601116629159,0.6344647156330613,0.6389295252984915,0.5480099853470315,0.4712126574456847,0.8479658564847968,0.4275739736694765,0.6823773209990294,0.3681530667791175,0.4118070492790029,0.6313155638870939,0.7766759118958205,0.6195601138458109,0.6397333531929763,0.3299632556271487,0.5465635247269044,0.8863608137478909,0.5708989805375347],[0.7176935425650939,0.6073283805170969,0.8378677998173621,0.7931300949045529,0.6759418666886342,0.52169659214019,0.5912844468134186,0.6406218602628342,0.5968153143538497,0.7608914348764781,0.9524117126142014,0.6792564664135844,0.5041147244442608,0.8025189634953906,0.6875363082898668,0.6816922245429579,0.6757727860416617,0.6434772867086079,0.6323528989520742,0.6741368657991837,0.6136384769387926,0.6326776614466724,0.6113076825121152,0.6801791224383178,0.6352660702821236,0.7404149553188488,0.6295496228498633,0.6523412642442598,0.7023241150122855,0.5915476455975354,0.5986729794261195,0.5509132572485328,0.5914664043406563,0.6770228372535668,0.7832793790368987,0.5912461332246149,0.5965030393450671,0.7257564943563971,0.6995258484505198,0.7053026635160292,0.7959183673469388],[1.91753487412749,1.29175272037924,2.067163041443901,1.200654781647563,1.124312726235241,1.615591789989959,1.266547465086961,0.9001426533263226,1.863584481393095,2.370446773449222,1.007904741768296,1.381482836039404,1.828253739251144,1.342729773708559,1.125109185048073,1.005414520892331,1.256182599309575,0.745538622186577,0.781843543150224,0.6972474697559381,1.513782115016354,0.9216188402082974,1.682642483233108,1.051571563080083,1.1351500186845,1.563131800106226,1.403601622773818,1.394534509216571,1.484009375370477,1.89822831578992,1.558071293993435,1.031327676466461,1.925545070392015,0.957153868401671,1.436677037589144,0.9152335515764092,1.685007419668435,1.7975179826019,0.8037016931661495,2.769898395886286,0.6834170854271358],["A","A","P","P","A","P","P","P","P","P","P","P","P","A","P","A","P","P","P","P","A","P","A","P","P","A","P","A","P","P","P","P","P","A","P","P","P","A","P","P","A"],["A","A","A","A","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","A","A","P","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","P","A"],["A","A","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","P","A"],["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","P","A","A","A","A","A","A","A"],["A","P","P","P","P","P","A","P","P","A","A","P","P","A","P","P","P","P","P","P","P","P","A","P","P","P","P","A","A","P","P","P","P","A","P","P","P","P","P","P","P"],["P","A","A","A","A","A","A","P","A","P","P","A","A","P","P","A","A","A","A","P","A","P","P","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","P","A","A"],["P","A","A","A","A","A","A","P","A","P","A","A","A","P","A","A","A","A","A","A","A","A","P","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","P","A"],["A","A","A","A","A","A","A","A","A","A","A","A","A","P","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["P","P","A","A","P","P","P","P","P","A","P","A","A","A","P","A","A","P","P","P","P","P","P","P","P","P","A","A","P","P","P","P","P","P","A","A","P","P","P","P","A"],["C","B","C","C","C","B","C","C","C","A","C","A","C","A","C","C","C","C","C","C","B","C","A","C","C","C","C","B","A","C","C","C","C","A","C","C","C","A","C","A","C"],["1","3","1","1","2","3","2","2","3","1","2","3","1","1","1","3","3","2","3","2","3","2","1","2","2","2","2","3","3","3","2","3","3","3","1","2","2","3","2","2","2"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eye_size<\/th>\n      <th>orbital_length<\/th>\n      <th>oral_gap_surface<\/th>\n      <th>oral_gape_shape<\/th>\n      <th>oral_gape_position<\/th>\n      <th>lower_jaw_length<\/th>\n      <th>operculum_width<\/th>\n      <th>head_length<\/th>\n      <th>body_depth<\/th>\n      <th>pectoral_fin_position<\/th>\n      <th>pectoral_fin_insertion<\/th>\n      <th>transversal_shape<\/th>\n      <th>caudal_peduncle_min_depth<\/th>\n      <th>dorsal_fin_insertion<\/th>\n      <th>eye_position<\/th>\n      <th>operculum_volume<\/th>\n      <th>photophores_ventral_position<\/th>\n      <th>gland_head<\/th>\n      <th>chin_barbel<\/th>\n      <th>front_barbel<\/th>\n      <th>small_teeth<\/th>\n      <th>large_teeth<\/th>\n      <th>fang_teeth<\/th>\n      <th>retractile_teeth<\/th>\n      <th>internal_teeth<\/th>\n      <th>gill_raker_types<\/th>\n      <th>oral_gape_axis<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="species-assemblages-matrix" class="level2">
<h2 class="anchored" data-anchor-id="species-assemblages-matrix">Species * assemblages matrix</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list of species </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sp_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rownames</span>(fish_traits), <span class="st">"Nannobrachium_atrum"</span>, <span class="st">"Cyclothone"</span>, <span class="st">"Stomias_boa_boa"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Metadata</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span>  utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"metadata.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculation of standardized biomass values (vertical  trawl opening * horizontal trawl opening * distance traveled)  </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">volume_filtered =</span> <span class="dv">24</span><span class="sc">*</span><span class="dv">58</span><span class="sc">*</span>distance)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># species biomass x depth  matrix 2002-2019 ----</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>data_biomass_2002_2019 <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_evhoe_catch_2002_2019.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"species"</span><span class="ot">=</span><span class="st">"Code_Station"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species=</span> <span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>, species))<span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">%in%</span>sp_names)<span class="sc">%&gt;%</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">row_to_names</span>(<span class="at">row_number =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.numeric)<span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Code_Station"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Code_Station<span class="sc">==</span><span class="st">"H0472"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span>Code_Station, <span class="at">names_to =</span> <span class="st">"species"</span>, <span class="at">values_to =</span> <span class="st">"Tot_V_HV"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Nom_Scientifique"</span><span class="ot">=</span><span class="st">"species"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># species biomass x depth  matrix 2021 ----</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>data_biomass_2021 <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_evhoe_catch_2021.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nom_Scientifique, Tot_V_HV, Code_Station)<span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nom_Scientifique=</span> <span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>,Nom_Scientifique))<span class="sc">%&gt;%</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Nom_Scientifique<span class="sc">%in%</span>sp_names)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># species biomass x depth  matrix 2022 ----</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>data_biomass_2022 <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_evhoe_catch_2022.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nom_Scientifique, Tot_V_HV, Code_Station)<span class="sc">%&gt;%</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nom_Scientifique=</span> <span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>,Nom_Scientifique))<span class="sc">%&gt;%</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Nom_Scientifique<span class="sc">%in%</span>sp_names)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co"># merge all matrix ----</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>depth_fish_biomass <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_biomass_2002_2019, data_biomass_2021, data_biomass_2022)<span class="sc">%&gt;%</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">"species"</span><span class="ot">=</span><span class="st">"Nom_Scientifique"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>         <span class="st">"station"</span><span class="ot">=</span><span class="st">"Code_Station"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata) <span class="sc">%&gt;%</span> </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, Tot_V_HV, depth, volume_filtered)<span class="sc">%&gt;%</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># divise biomass by the volume filtered at each trawl (g.m3)</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass_cpu=</span>(Tot_V_HV<span class="sc">/</span>volume_filtered)<span class="sc">*</span><span class="dv">1000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, depth, biomass_cpu)<span class="sc">%&gt;%</span>  </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add column with depth layer</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">depth_layer =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">0</span>, <span class="dv">174</span>) <span class="sc">~</span> <span class="st">"Epipelagic"</span>,</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">175</span>, <span class="dv">699</span>) <span class="sc">~</span> <span class="st">"Upper mesopelagic"</span>,</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">700</span>, <span class="dv">999</span>) <span class="sc">~</span> <span class="st">"Lower mesopelagic"</span>,</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(depth, <span class="dv">1000</span>, <span class="dv">2000</span>) <span class="sc">~</span> <span class="st">"Bathypelagic"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>depth)<span class="sc">%&gt;%</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, depth_layer)<span class="sc">%&gt;%</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass=</span><span class="fu">sum</span>(biomass_cpu))<span class="sc">%&gt;%</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(biomass_cpu))<span class="sc">%&gt;%</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> species, <span class="at">values_from =</span> biomass)<span class="sc">%&gt;%</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"depth_layer"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">#change species name</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Lampanyctus_ater"</span><span class="ot">=</span><span class="st">"Nannobrachium_atrum"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Cyclothone_sp"</span><span class="ot">=</span><span class="st">"Cyclothone"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Stomias_boa"</span><span class="ot">=</span><span class="st">"Stomias_boa_boa"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><strong>assemblages</strong> = depth layers</li>
<li><strong>biomass data</strong> = all EVHOE data 2002-2022 (in m^3)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(depth_fish_biomass))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-788e571b179bb8ef6c97" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-788e571b179bb8ef6c97">{"x":{"filter":"none","vertical":false,"data":[["Upper mesopelagic","Bathypelagic","Epipelagic","Lower mesopelagic"],[0,1.46979030819833e-05,0,0],[0.0003406467398861954,0.0001830509681171748,2.247997235116746e-05,0.0003200058914129239],[9.227241317699017e-06,1.74621026731269e-06,3.073702565095805e-07,1.350435600850066e-06],[0.0004384521811043648,0.0001584056765425404,8.294544471760621e-06,0.0001106243426396359],[0,0.0003787778721707042,0,0],[2.358034623529346e-05,0.0005287378514412932,6.563685598332661e-05,0.0001055074390119732],[0,6.387171618704474e-06,0,1.843488085160593e-05],[2.013956910292874e-06,6.994079564419096e-05,2.19422970249756e-07,4.761470024474112e-06],[0.0002505891214706563,9.271012727896899e-05,4.602250525025226e-05,6.849662314381425e-05],[3.397291188001234e-06,0.0001325848282254463,2.556247673814617e-07,2.563671675378479e-05],[1.126342196284479e-05,9.960012576538391e-05,2.567248751922145e-06,0.0001747199582490278],[2.691171361888271e-06,6.750422967770746e-06,0,1.009996741507595e-05],[0,2.28785367484745e-06,0,9.384757187990091e-07],[1.870062508390188e-06,5.878217370546951e-06,0,4.022361141703668e-05],[0,1.60261481517401e-05,0,3.242315186476398e-05],[0,2.798938102147332e-05,0,0],[5.69846685013904e-06,4.644978163458014e-06,0,2.661892487971513e-06],[0.0007297286548823404,0.001658709295750286,5.200324394919217e-05,0.001188357747672526],[0,0.0003042711061727375,0,0],[1.4638098214541e-06,3.306115556613948e-06,4.771662324453952e-06,1.404006574068237e-05],[1.764407093688444e-05,7.249054994238721e-05,2.962210098371706e-06,1.000613525491782e-05],[7.55181708337206e-06,6.886475881291627e-05,0,0],[0,2.595768484792304e-05,0,1.445797067587536e-05],[8.998632207904398e-07,0.0001779188482664291,0,6.469723997890821e-06],[0,0.0001220139226306193,0,0],[2.459678973321686e-05,5.735472266543518e-05,4.784878324444082e-05,0.0003456096185494774],[3.516796308811765e-06,2.815171303870814e-05,6.58268910749268e-07,1.469189176696493e-05],[2.839296619579706e-05,3.343758464157721e-05,1.192915581113488e-06,2.048984646223213e-05],[0.0001159430378285174,0.0001850958355876571,0.0001062516187806056,0.0001508825508098425],[8.308549484029906e-06,0.0002322379997396959,6.58268910749268e-07,6.370667648837288e-05],[0,0.0007834072022762728,0,0],[0.0005374538886043501,0.0004120020185634977,2.846278619695132e-05,0.0002418615151627449],[3.294686463826039e-07,5.484714652404532e-06,4.38845940499512e-07,2.308553444175256e-06],[0,9.052632253719798e-06,0,0],[3.737319094047666e-06,5.963964403942441e-06,0,1.606357653595781e-05],[3.165241984961546e-05,9.885353512621318e-05,1.601787682823219e-05,0.0001298938334924048],[9.009649424629528e-05,0.0007415390905688788,2.358796930184877e-05,0.0001955665485722926],[0,3.314879065408746e-05,4.38845940499512e-07,0],[0.0002606241551788656,0.0004312611671966216,5.810413668274208e-05,0.0003255567176324167],[0.001597834021419992,0.0004313707701624349,2.073547068860194e-05,0.0009341500970614152],[0,9.053856407257921e-06,3.655434173554902e-05,5.952250133696695e-06]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Anoplogaster_cornuta<\/th>\n      <th>Arctozenus_risso<\/th>\n      <th>Argyropelecus_hemigymnus<\/th>\n      <th>Argyropelecus_olfersii<\/th>\n      <th>Bathylagus_euryops<\/th>\n      <th>Benthosema_glaciale<\/th>\n      <th>Bolinichthys_supralateralis<\/th>\n      <th>Borostomias_antarcticus<\/th>\n      <th>Ceratoscopelus_maderensis<\/th>\n      <th>Chauliodus_sloani<\/th>\n      <th>Cyclothone_sp<\/th>\n      <th>Derichthys_serpentinus<\/th>\n      <th>Diaphus_metopoclampus<\/th>\n      <th>Evermannella_balbo<\/th>\n      <th>Gonostoma_elongatum<\/th>\n      <th>Holtbyrnia_anomala<\/th>\n      <th>Holtbyrnia_macrops<\/th>\n      <th>Lampanyctus_crocodilus<\/th>\n      <th>Lampanyctus_macdonaldi<\/th>\n      <th>Lestidiops_sphyrenoides<\/th>\n      <th>Lobianchia_gemellarii<\/th>\n      <th>Malacosteus_niger<\/th>\n      <th>Maulisia_argipalla<\/th>\n      <th>Maulisia_mauli<\/th>\n      <th>Maulisia_microlepis<\/th>\n      <th>Maurolicus_muelleri<\/th>\n      <th>Melanostigma_atlanticum<\/th>\n      <th>Melanostomias_bartonbeani<\/th>\n      <th>Myctophum_punctatum<\/th>\n      <th>Lampanyctus_ater<\/th>\n      <th>Normichthys_operosus<\/th>\n      <th>Notoscopelus_kroyeri<\/th>\n      <th>Paralepis_coregonoides<\/th>\n      <th>Photostylus_pycnopterus<\/th>\n      <th>Sagamichthys_schnakenbecki<\/th>\n      <th>Searsia_koefoedi<\/th>\n      <th>Serrivomer_beanii<\/th>\n      <th>Sigmops_bathyphilus<\/th>\n      <th>Stomias_boa<\/th>\n      <th>Xenodermichthys_copei<\/th>\n      <th>Notoscopelus_bolini<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="species-depth-distribution" class="level3">
<h3 class="anchored" data-anchor-id="species-depth-distribution">Species depth distribution</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>depth_distribution <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_biomass_2002_2019, data_biomass_2021, data_biomass_2022)<span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"station"</span><span class="ot">=</span><span class="st">"Code_Station"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata)<span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"species"</span><span class="ot">=</span><span class="st">"Nom_Scientifique"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(station))<span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Tot_V_HV<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species)<span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass_tot =</span> <span class="fu">sum</span>(Tot_V_HV))<span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, depth)<span class="sc">%&gt;%</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass_depth =</span> <span class="fu">sum</span>(Tot_V_HV))<span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, biomass_depth, biomass_tot, depth)<span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, depth)<span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass_rel=</span>biomass_depth<span class="sc">/</span>biomass_tot<span class="sc">*</span><span class="dv">100</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, depth, biomass_rel)<span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biomass =</span> <span class="fu">as.integer</span>(biomass_rel))<span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>biomass_rel)<span class="sc">%&gt;%</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">uncount</span>(biomass)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Order in function of median depth</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>depth_distribution<span class="sc">$</span>species <span class="ot">=</span> <span class="fu">with</span>(depth_distribution, <span class="fu">reorder</span>(species, depth, median))  </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(depth_distribution,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> depth, <span class="at">y =</span> species, <span class="at">group =</span> species))<span class="sc">+</span> </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  ggridges<span class="sc">::</span><span class="fu">stat_density_ridges</span>(<span class="at">quantile_lines =</span> <span class="cn">TRUE</span>, <span class="at">quantiles =</span> <span class="fl">0.5</span> , <span class="at">alpha=</span><span class="fl">0.4</span>, <span class="at">size=</span><span class="fl">0.7</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                                <span class="at">rel_min_height =</span> <span class="fl">0.001</span>, <span class="at">scale=</span><span class="fl">1.2</span>, <span class="at">col=</span><span class="st">"gray60"</span>)<span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">"left"</span>)<span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="at">label =</span> <span class="st">""</span>)<span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Depth (m)"</span>)<span class="sc">+</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"italic"</span>, <span class="at">size=</span><span class="dv">9</span>, <span class="at">angle=</span><span class="dv">80</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>))<span class="sc">+</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="st">"none"</span>, <span class="at">col=</span><span class="st">"none"</span>, <span class="at">alpha=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/density_depth_distribution-1.png" class="img-fluid" width="1056"></p>
</div>
</div>
</section>
</section>
<section id="traits-types" class="level2">
<h2 class="anchored" data-anchor-id="traits-types">Traits types</h2>
<p>The <strong>first column</strong> contains <strong>traits name</strong>. The <strong>second column</strong> contains <strong>traits type</strong> following this code:</p>
<ul>
<li><p><strong>N</strong>: nominal trait (factor variable)</p></li>
<li><p><strong>O</strong>: ordinal traits (ordered variable)</p></li>
<li><p><strong>Q</strong>: quantitative traits (numeric values)</p></li>
<li><p>1/3 of the traits are nominal (traits related to teeth and photophores), need to give them different weights so as not to overestimate functional diversity?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fish_traits_cat <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"fish_traits_cat.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(fish_traits_cat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0ec39266b64f79a410b9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0ec39266b64f79a410b9">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27"],["eye_size","orbital_length","oral_gap_surface","oral_gape_shape","oral_gape_position","lower_jaw_length","operculum_width","head_length","body_depth","pectoral_fin_position","pectoral_fin_insertion","transversal_shape","caudal_peduncle_min_depth","dorsal_fin_insertion","eye_position","operculum_volume","photophores_ventral_position","gland_head","chin_barbel","front_barbel","small_teeth","large_teeth","fang_teeth","retractile_teeth","internal_teeth","gill_raker_types","oral_gape_axis"],["Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","Q","N","N","N","N","N","N","N","N","N","O","O"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>trait_name<\/th>\n      <th>trait_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="cwm" class="level1">
<h1>1. CWM</h1>
<p><strong>Community Weighted Metric</strong> : somme de l’abondance relative d’une espèce x valeur du trait</p>
<ul>
<li><p>trait quantittatif : valeur moyenne du trait si on prend un individu au hasard dans l’assemblage</p></li>
<li><p>trait catégoriel : proportion des espèces possédant ce trait, une valeur élevée peut indiquer soit qu’un grand nombre possèdent se trait ou que l’espèce avec la plus forte abondance relative possède ce trait</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spxcom.matrix ----</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>spxcom.matrix <span class="ot">&lt;-</span>  depth_fish_biomass <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">"Epipelagic"</span>, <span class="st">"Upper mesopelagic"</span>, <span class="st">"Lower mesopelagic"</span>,<span class="st">"Bathypelagic"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"species"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"species"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># spxtraits.matrix ----</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>spxtraits.matrix <span class="ot">&lt;-</span> fish_traits <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">17</span><span class="sc">:</span><span class="dv">25</span>, <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="st">"P"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="st">"A"</span>, <span class="dv">0</span>, .))),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="dv">26</span>, <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="st">"A"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="st">"B"</span>, <span class="dv">2</span>, <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="st">"C"</span>, <span class="dv">3</span>, .))))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(gill_raker_types, oral_gape_axis)) </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#check rownames</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#rownames(spxtraits.matrix) == rownames(spxcom.matrix)</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>result_CWM <span class="ot">&lt;-</span> FD<span class="sc">::</span><span class="fu">functcomp</span>(spxtraits.matrix, <span class="fu">t</span>(spxcom.matrix)) </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#FD::functcomp(spxtraits.matrix, t(spxcom.matrix), CWM.type = "all")</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(result_CWM))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5b3dd04833d1d4513662" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5b3dd04833d1d4513662">{"x":{"filter":"none","vertical":false,"data":[["Epipelagic","Upper mesopelagic","Lower mesopelagic","Bathypelagic"],[0.5264502630476001,0.5340917292069929,0.5140116131672948,0.5071153226163653],[0.07087703794886653,0.07255448226100607,0.06167097014872081,0.0621819100670699],[497.8593608534,779.9564958142092,788.7313938189892,958.3656802712215],[1.339452782109091,1.556306306290292,1.462287203184484,1.238940286255584],[0.5892356730738959,0.6674084311606796,0.6660852135095413,0.600072516137201],[0.1651799844422884,0.1620517304436526,0.161014328692584,0.1673610589839888],[8.113567187739578,14.48773022269152,13.32449112000713,12.86427286870236],[0.2385121677555892,0.2445089607289577,0.2365572684005304,0.2399268395005708],[0.1843159049908707,0.205007249611302,0.169558608825106,0.1731414577870444],[0.3727802198337863,0.292274127012442,0.3185208866838657,0.3535860351581783],[0.2523502691482608,0.2499818462269511,0.2435588712276255,0.2505763724636959],[0.0467648766895262,0.03178547208922426,0.03736512513707586,0.0290234128492122],[5.063773139544572,6.132516300967942,6.348204274912248,7.143403138722079],[0.5140025858199347,0.5228335578328848,0.5306864796471685,0.5131145150895369],[0.6204681801610573,0.702651322309507,0.6842532901756222,0.6560097892439939],[1.638251170258219,1.209797621080455,1.234232874258506,1.350116835943927],["1","1","1","1"],["0","0","0","0"],["0","0","0","0"],["0","0","0","0"],["1","1","1","1"],["0","0","0","0"],["0","0","0","0"],["0","0","0","0"],["1","1","1","1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eye_size<\/th>\n      <th>orbital_length<\/th>\n      <th>oral_gap_surface<\/th>\n      <th>oral_gape_shape<\/th>\n      <th>oral_gape_position<\/th>\n      <th>lower_jaw_length<\/th>\n      <th>operculum_width<\/th>\n      <th>head_length<\/th>\n      <th>body_depth<\/th>\n      <th>pectoral_fin_position<\/th>\n      <th>pectoral_fin_insertion<\/th>\n      <th>transversal_shape<\/th>\n      <th>caudal_peduncle_min_depth<\/th>\n      <th>dorsal_fin_insertion<\/th>\n      <th>eye_position<\/th>\n      <th>operculum_volume<\/th>\n      <th>photophores_ventral_position<\/th>\n      <th>gland_head<\/th>\n      <th>chin_barbel<\/th>\n      <th>front_barbel<\/th>\n      <th>small_teeth<\/th>\n      <th>large_teeth<\/th>\n      <th>fang_teeth<\/th>\n      <th>retractile_teeth<\/th>\n      <th>internal_teeth<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="build-a-functional-space-using-the-mfd-package" class="level1">
<h1>2. Build a functional space using the mFD package</h1>
<section id="compute-data-summaries" class="level2">
<h2 class="anchored" data-anchor-id="compute-data-summaries">2.1 Compute data summaries</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Summary of the assemblages * species data.frame ----</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>asb_sp_fish_summ <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">asb.sp.summary</span>(<span class="at">asb_sp_w =</span> depth_fish_biomass)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>asb_sp_fish_occ  <span class="ot">&lt;-</span> asb_sp_fish_summ<span class="sc">$</span><span class="st">"asb_sp_occ"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(asb_sp_fish_occ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-99fbeae400ef0d9ae51b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-99fbeae400ef0d9ae51b">{"x":{"filter":"none","vertical":false,"data":[["Upper mesopelagic","Bathypelagic","Epipelagic","Lower mesopelagic"],[0,1,0,0],[1,1,1,1],[1,1,1,1],[1,1,1,1],[0,1,0,0],[1,1,1,1],[0,1,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,0,1],[0,1,0,1],[1,1,0,1],[0,1,0,1],[0,1,0,0],[1,1,0,1],[1,1,1,1],[0,1,0,0],[1,1,1,1],[1,1,1,1],[1,1,0,0],[0,1,0,1],[1,1,0,1],[0,1,0,0],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[0,1,0,0],[1,1,1,1],[1,1,1,1],[0,1,0,0],[1,1,0,1],[1,1,1,1],[1,1,1,1],[0,1,1,0],[1,1,1,1],[1,1,1,1],[0,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Anoplogaster_cornuta<\/th>\n      <th>Arctozenus_risso<\/th>\n      <th>Argyropelecus_hemigymnus<\/th>\n      <th>Argyropelecus_olfersii<\/th>\n      <th>Bathylagus_euryops<\/th>\n      <th>Benthosema_glaciale<\/th>\n      <th>Bolinichthys_supralateralis<\/th>\n      <th>Borostomias_antarcticus<\/th>\n      <th>Ceratoscopelus_maderensis<\/th>\n      <th>Chauliodus_sloani<\/th>\n      <th>Cyclothone_sp<\/th>\n      <th>Derichthys_serpentinus<\/th>\n      <th>Diaphus_metopoclampus<\/th>\n      <th>Evermannella_balbo<\/th>\n      <th>Gonostoma_elongatum<\/th>\n      <th>Holtbyrnia_anomala<\/th>\n      <th>Holtbyrnia_macrops<\/th>\n      <th>Lampanyctus_crocodilus<\/th>\n      <th>Lampanyctus_macdonaldi<\/th>\n      <th>Lestidiops_sphyrenoides<\/th>\n      <th>Lobianchia_gemellarii<\/th>\n      <th>Malacosteus_niger<\/th>\n      <th>Maulisia_argipalla<\/th>\n      <th>Maulisia_mauli<\/th>\n      <th>Maulisia_microlepis<\/th>\n      <th>Maurolicus_muelleri<\/th>\n      <th>Melanostigma_atlanticum<\/th>\n      <th>Melanostomias_bartonbeani<\/th>\n      <th>Myctophum_punctatum<\/th>\n      <th>Lampanyctus_ater<\/th>\n      <th>Normichthys_operosus<\/th>\n      <th>Notoscopelus_kroyeri<\/th>\n      <th>Paralepis_coregonoides<\/th>\n      <th>Photostylus_pycnopterus<\/th>\n      <th>Sagamichthys_schnakenbecki<\/th>\n      <th>Searsia_koefoedi<\/th>\n      <th>Serrivomer_beanii<\/th>\n      <th>Sigmops_bathyphilus<\/th>\n      <th>Stomias_boa<\/th>\n      <th>Xenodermichthys_copei<\/th>\n      <th>Notoscopelus_bolini<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="computing-distances-between-species-based-on-functional-traits" class="level2">
<h2 class="anchored" data-anchor-id="computing-distances-between-species-based-on-functional-traits">2.2 Computing distances between species based on functional traits</h2>
<ul>
<li>We have non-continuous traits so we use the <strong>Gower distance</strong> <em>(metric = “gower”)</em> as this method allows traits weighting.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sp_dist_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">funct.dist</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_tr         =</span> fish_traits,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">tr_cat        =</span> fish_traits_cat,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric        =</span> <span class="st">"gower"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale_euclid  =</span> <span class="st">"scale_center"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ordinal_var   =</span> <span class="st">"classic"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_type   =</span> <span class="st">"equal"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stop_if_NA    =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Output of the function mFD::funct.dist() ----</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#round(sp_dist_fish, 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="building-functional-spaces-and-chosing-the-best-one" class="level2">
<h2 class="anchored" data-anchor-id="building-functional-spaces-and-chosing-the-best-one">2.3 Building functional spaces and chosing the best one</h2>
<section id="computing-several-multimensional-functional-spaces-and-assessing-their-quality" class="level3">
<h3 class="anchored" data-anchor-id="computing-several-multimensional-functional-spaces-and-assessing-their-quality">2.3.1 Computing several multimensional functional spaces and assessing their quality</h3>
<ul>
<li>mFD evaluates the quality of PCoA-based multidimensional spaces according to the deviation between trait-based distances and distances in the functional space (extension of Maire et al.&nbsp;(2015) framework).</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fspaces_quality_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">quality.fspaces</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_dist             =</span> sp_dist_fish,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxdim_pcoa         =</span> <span class="dv">10</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">deviation_weighting =</span> <span class="st">"absolute"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fdist_scaling       =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fdendro             =</span> <span class="st">"average"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Quality metrics of functional spaces ----</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(fspaces_quality_fish<span class="sc">$</span><span class="st">"quality_fspaces"</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               mad
pcoa_1d      0.140
pcoa_2d      0.078
pcoa_3d      0.049
pcoa_4d      0.030
pcoa_5d      0.023
pcoa_6d      0.016
pcoa_7d      0.014
pcoa_8d      0.014
pcoa_9d      0.016
pcoa_10d     0.018
tree_average 0.039</code></pre>
</div>
</div>
<p>The space with the best quality has the lowest quality metric. 5-D space good ?</p>
</section>
<section id="illustrating-the-quality-of-the-functional-spaces" class="level3">
<h3 class="anchored" data-anchor-id="illustrating-the-quality-of-the-functional-spaces">2.3.2 Illustrating the quality of the functional spaces</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mFD<span class="sc">::</span><span class="fu">quality.fspaces.plot</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fspaces_quality            =</span> fspaces_quality_fish,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">quality_metric             =</span> <span class="st">"mad"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fspaces_plot               =</span> <span class="fu">c</span>(<span class="st">"tree_average"</span>, <span class="st">"pcoa_2d"</span>, <span class="st">"pcoa_3d"</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"pcoa_4d"</span>, <span class="st">"pcoa_5d"</span>, <span class="st">"pcoa_6d"</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file                  =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_dist                 =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_dev                  =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_qdev                 =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient_deviation         =</span> <span class="fu">c</span>(<span class="at">neg =</span> <span class="st">"darkblue"</span>, <span class="at">nul =</span> <span class="st">"grey80"</span>, <span class="at">pos =</span> <span class="st">"darkred"</span>),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gradient_deviation_quality =</span> <span class="fu">c</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_lab                      =</span> <span class="st">"Trait-based distance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/fspaces_quality_plot-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
<p>This function generates a figure with three panels (in rows) for each selected functional space (in columns). Each column represents a functional space, the value of the quality metric is written on the top of each column. The x-axis of all panels represents trait-based distances. The y-axis is different for each row:</p>
<ul>
<li>on the first (top) row, the y-axis represents species functional distances in the multidimensional space. Thus, the closer species are to the 1:1 line, the better distances in the functional space fit trait-based ones.</li>
<li>on the second row, the y-axis shows the raw deviation of species distances in the functional space compared to trait-based distances. Thus, the raw deviation reflects the distance to the horizontal line.</li>
<li>on the third row (bottom), the y-axis shows the absolute or squared deviation of the (“scaled”) distance in the functional space. It is the deviation that is taken into account for computing the quality metric.</li>
</ul>
</section>
<section id="testing-the-correlation-between-functional-axes-and-traits" class="level3">
<h3 class="anchored" data-anchor-id="testing-the-correlation-between-functional-axes-and-traits">2.3.3 Testing the correlation between functional axes and traits</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sp_faxes_coord_fish <span class="ot">&lt;-</span> fspaces_quality_fish<span class="sc">$</span><span class="st">"details_fspaces"</span><span class="sc">$</span><span class="st">"sp_pc_coord"</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># As we have 27 traits we have to split the df to see correlation between functional axes and traits </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># first set ----</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>fish_traits_1 <span class="ot">&lt;-</span> fish_traits<span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">traits.faxes.cor</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_tr          =</span> fish_traits_1, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_faxes_coord =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)], </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot           =</span> T)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Print traits with significant effect ----</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes<span class="sc">$</span><span class="st">"tr_faxes_stat"</span>[<span class="fu">which</span>(fish_tr_faxes<span class="sc">$</span><span class="st">"tr_faxes_stat"</span><span class="sc">$</span><span class="st">"p.value"</span> <span class="sc">&lt;</span> <span class="fl">0.05</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                trait axis         test stat value p.value
1            eye_size  PC1 Linear Model   r2 0.167  0.0080
2            eye_size  PC2 Linear Model   r2 0.196  0.0037
3            eye_size  PC3 Linear Model   r2 0.138  0.0167
4            eye_size  PC4 Linear Model   r2 0.101  0.0432
5      orbital_length  PC1 Linear Model   r2 0.404  0.0000
6      orbital_length  PC2 Linear Model   r2 0.099  0.0447
9    oral_gap_surface  PC1 Linear Model   r2 0.126  0.0225
10   oral_gap_surface  PC2 Linear Model   r2 0.518  0.0000
14    oral_gape_shape  PC2 Linear Model   r2 0.139  0.0165
20 oral_gape_position  PC4 Linear Model   r2 0.197  0.0037
22   lower_jaw_length  PC2 Linear Model   r2 0.678  0.0000
26    operculum_width  PC2 Linear Model   r2 0.519  0.0000
29        head_length  PC1 Linear Model   r2 0.336  0.0001
30        head_length  PC2 Linear Model   r2 0.364  0.0000
34         body_depth  PC2 Linear Model   r2 0.366  0.0000
35         body_depth  PC3 Linear Model   r2 0.178  0.0060</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot ----</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes<span class="sc">$</span><span class="st">"tr_faxes_plot"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/test_correlation-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># second set ----</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fish_traits_2 <span class="ot">&lt;-</span> fish_traits<span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">18</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes_2 <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">traits.faxes.cor</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_tr          =</span> fish_traits_2, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_faxes_coord =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)], </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot           =</span> T)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Print traits with significant effect ----</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes_2<span class="sc">$</span><span class="st">"tr_faxes_stat"</span>[<span class="fu">which</span>(fish_tr_faxes_2<span class="sc">$</span><span class="st">"tr_faxes_stat"</span><span class="sc">$</span><span class="st">"p.value"</span> <span class="sc">&lt;</span> <span class="fl">0.05</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          trait axis           test stat value p.value
2         pectoral_fin_position  PC2   Linear Model   r2 0.264  0.0006
5        pectoral_fin_insertion  PC1   Linear Model   r2 0.294  0.0002
6        pectoral_fin_insertion  PC2   Linear Model   r2 0.379  0.0000
9             transversal_shape  PC1   Linear Model   r2 0.114  0.0310
11            transversal_shape  PC3   Linear Model   r2 0.221  0.0019
14    caudal_peduncle_min_depth  PC2   Linear Model   r2 0.400  0.0000
19         dorsal_fin_insertion  PC3   Linear Model   r2 0.168  0.0078
23                 eye_position  PC3   Linear Model   r2 0.190  0.0043
25             operculum_volume  PC1   Linear Model   r2 0.097  0.0472
32 photophores_ventral_position  PC4 Kruskal-Wallis eta2 0.590  0.0000
33                   gland_head  PC1 Kruskal-Wallis eta2 0.245  0.0011</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot ----</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes_2<span class="sc">$</span><span class="st">"tr_faxes_plot"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/test_correlation_2-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># third set ----</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fish_traits_3 <span class="ot">&lt;-</span> fish_traits<span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">19</span><span class="sc">:</span><span class="dv">27</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes_3 <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">traits.faxes.cor</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_tr          =</span> fish_traits_3, </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_faxes_coord =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)], </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot           =</span> T)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Print traits with significant effect ----</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes_3<span class="sc">$</span><span class="st">"tr_faxes_stat"</span>[<span class="fu">which</span>(fish_tr_faxes_3<span class="sc">$</span><span class="st">"tr_faxes_stat"</span><span class="sc">$</span><span class="st">"p.value"</span> <span class="sc">&lt;</span> <span class="fl">0.05</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              trait axis           test stat value p.value
1       chin_barbel  PC1 Kruskal-Wallis eta2 0.142  0.0107
4       chin_barbel  PC4 Kruskal-Wallis eta2 0.183  0.0043
9       small_teeth  PC1 Kruskal-Wallis eta2 0.317  0.0003
12      small_teeth  PC4 Kruskal-Wallis eta2 0.095  0.0298
13      large_teeth  PC1 Kruskal-Wallis eta2 0.448  0.0000
14      large_teeth  PC2 Kruskal-Wallis eta2 0.214  0.0022
17       fang_teeth  PC1 Kruskal-Wallis eta2 0.410  0.0000
25   internal_teeth  PC1 Kruskal-Wallis eta2 0.079  0.0437
27   internal_teeth  PC3 Kruskal-Wallis eta2 0.634  0.0000
29 gill_raker_types  PC1 Kruskal-Wallis eta2 0.333  0.0007
30 gill_raker_types  PC2 Kruskal-Wallis eta2 0.368  0.0003
34   oral_gape_axis  PC2 Kruskal-Wallis eta2 0.378  0.0003
35   oral_gape_axis  PC3 Kruskal-Wallis eta2 0.198  0.0086</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot ----</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fish_tr_faxes_3<span class="sc">$</span><span class="st">"tr_faxes_plot"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/test_correlation_3-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
</section>
</section>
<section id="plotting-the-selected-functional-space-and-position-of-species" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-selected-functional-space-and-position-of-species">2.4 Plotting the selected functional space and position of species</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sp_faxes_coord_fish <span class="ot">&lt;-</span> fspaces_quality_fish<span class="sc">$</span><span class="st">"details_fspaces"</span><span class="sc">$</span><span class="st">"sp_pc_coord"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>big_plot <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">funct.space.plot</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_faxes_coord  =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)],</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes           =</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file       =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm        =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes     =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_ch         =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_vertices   =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm      =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input     =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>big_plot<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_functional_space-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
</section>
<section id="computing-and-plotting-fd-indices-using-the-mfd-package" class="level1">
<h1>3. Computing and plotting FD indices using the mFD package</h1>
<section id="computing-and-plotting-alpha-fd-indices" class="level2">
<h2 class="anchored" data-anchor-id="computing-and-plotting-alpha-fd-indices">3.1 Computing and plotting alpha FD indices</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>alpha_fd_indices_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">alpha.fd.multidim</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_faxes_coord   =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">asb_sp_w         =</span> depth_fish_biomass,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ind_vect         =</span> <span class="fu">c</span>(<span class="st">"fdis"</span>, <span class="st">"fric"</span>, <span class="st">"fdiv"</span>, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"fspe"</span>, <span class="st">"fide"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaling          =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">details_returned =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function has two main outputs:</p>
<ul>
<li>a data.frame gathering indices values in each assemblage (for FIde values, there are as many columns as there are axes to the studied functional space).</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fd_ind_values_fish <span class="ot">&lt;-</span> alpha_fd_indices_fish<span class="sc">$</span><span class="st">"functional_diversity_indices"</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">round</span>(fd_ind_values_fish, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-20b0bc87005b9e36217c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-20b0bc87005b9e36217c">{"x":{"filter":"none","vertical":false,"data":[["Upper mesopelagic","Bathypelagic","Epipelagic","Lower mesopelagic"],[28,41,24,32],[0.433,0.455,0.386,0.456],[0.718,1,0.355,0.641],[0.589,0.652,0.612,0.612],[0.37,0.386,0.377,0.374],[-0.04,-0.018,-0.036,-0.024],[-0.022,-0.017,-0.047,-0.028],[-0.008,0.03,0.02,0.008999999999999999],[0.005,0.024,0.038,0.02]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sp_richn<\/th>\n      <th>fdis<\/th>\n      <th>fric<\/th>\n      <th>fdiv<\/th>\n      <th>fspe<\/th>\n      <th>fide_PC1<\/th>\n      <th>fide_PC2<\/th>\n      <th>fide_PC3<\/th>\n      <th>fide_PC4<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>a details list of data.frames and lists gathering information such as coordinates of centroids, distances and identity of the nearest neighbour, distances to the centroid, etc. The user does not have to directly use it but it will be useful if FD indices are then plotted. It can be retrieved through:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>details_list_fish <span class="ot">&lt;-</span> alpha_fd_indices_fish<span class="sc">$</span><span class="st">"details"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plots_alpha <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">alpha.multidim.plot</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_alpha_fd_multidim =</span> alpha_fd_indices_fish,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm              =</span> <span class="fu">c</span>(<span class="st">"Epipelagic"</span>, <span class="st">"Bathypelagic"</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ind_nm                   =</span> <span class="fu">c</span>(<span class="st">"fdis"</span>, <span class="st">"fric"</span>, <span class="st">"fdiv"</span>, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"fspe"</span>, <span class="st">"fide"</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                    =</span> <span class="cn">NULL</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                 =</span> <span class="cn">NULL</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes              =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm               =</span> <span class="cn">NULL</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_file                =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input              =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fric-functional-richness" class="level3">
<h3 class="anchored" data-anchor-id="fric-functional-richness"><strong>FRic Functional Richness</strong></h3>
<ul>
<li>the proportion of functional space filled by species of the studied assemblage, i.e.&nbsp;the volume inside the convex-hull shaping species. To compute FRic the number of species must be at least higher than the number of functional axis + 1.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>plots_alpha<span class="sc">$</span><span class="st">"fric"</span><span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_FRic-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
<section id="fdiv-functional-divergence" class="level3">
<h3 class="anchored" data-anchor-id="fdiv-functional-divergence"><strong>FDiv Functional Divergence</strong></h3>
<ul>
<li>the proportion of the biomass supported by the species with the most extreme functional traits i.e.&nbsp;the ones located close to the edge of the convex-hull filled by the assemblage</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plots_alpha<span class="sc">$</span><span class="st">"fdiv"</span><span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_FDiv-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
<section id="fspe-functional-specialization" class="level3">
<h3 class="anchored" data-anchor-id="fspe-functional-specialization"><strong>FSpe Functional Specialization</strong></h3>
<ul>
<li>the biomass weighted mean distance to the mean position of species from the global pool (present in all assemblages).</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>plots_alpha<span class="sc">$</span><span class="st">"fspe"</span><span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_FSpe-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
<section id="fdis-functional-dispersion" class="level3">
<h3 class="anchored" data-anchor-id="fdis-functional-dispersion"><strong>FDis Functional Dispersion</strong></h3>
<ul>
<li>the biomass weighted deviation of species traits values from the center of the functional space filled by the assemblage i.e.&nbsp;the biomass-weighted mean distance to the biomass-weighted mean trait values of the assemblage.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>plots_alpha<span class="sc">$</span><span class="st">"fdis"</span><span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_FDis-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
<section id="fide-functional-identity" class="level3">
<h3 class="anchored" data-anchor-id="fide-functional-identity"><strong>FIde Functional Identity</strong></h3>
<ul>
<li>the mean traits values for the assemblage. FIde is always computed when FDis is computed.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plots_alpha<span class="sc">$</span><span class="st">"fide"</span><span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_FIde-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
</section>
<section id="computing-and-plotting-beta-fd-indices" class="level2">
<h2 class="anchored" data-anchor-id="computing-and-plotting-beta-fd-indices">3.2.Computing and plotting beta FD indices</h2>
<ul>
<li>The function returns a list containing:</li>
<li>a dist object with beta indices values for each pair of assemblages:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>beta_fd_indices_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.fd.multidim</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">sp_faxes_coord   =</span> sp_faxes_coord_fish[ , <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)],</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">asb_sp_occ       =</span> asb_sp_fish_occ,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">check_input      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_family      =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">details_returned =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Serial computing of convex hulls shaping assemblages with conv1

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |======================================================================| 100%
Serial computing of intersections between pairs of assemblages with inter_geom_coord

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(beta_fd_indices_fish<span class="sc">$</span><span class="st">"pairasb_fbd_indices"</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$jac_diss
                  Upper mesopelagic Bathypelagic Epipelagic
Bathypelagic              0.2817243                        
Epipelagic                0.5059558    0.6450816           
Lower mesopelagic         0.1479024    0.3593021  0.4460600

$jac_turn
                  Upper mesopelagic Bathypelagic   Epipelagic
Bathypelagic           9.963967e-16                          
Epipelagic             2.203684e-04 0.000000e+00             
Lower mesopelagic      4.716059e-02 0.000000e+00 3.706431e-05

$jac_nest
                  Upper mesopelagic Bathypelagic Epipelagic
Bathypelagic              0.2817243                        
Epipelagic                0.5057354    0.6450816           
Lower mesopelagic         0.1007419    0.3593021  0.4460230</code></pre>
</div>
</div>
<ul>
<li>a vector containing the FRic value for each assemblage retrieved through the details_beta list:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>beta_fd_indices_fish<span class="sc">$</span><span class="st">"details"</span><span class="sc">$</span><span class="st">"asb_FRic"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Upper mesopelagic      Bathypelagic        Epipelagic Lower mesopelagic 
        0.7182757         1.0000000         0.3549184         0.6406979 </code></pre>
</div>
</div>
<ul>
<li>a list of vectors containing names of species being vertices of the convex hull for each assemblage retrieved through the details_beta list:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>beta_fd_indices_fish<span class="sc">$</span><span class="st">"details"</span><span class="sc">$</span><span class="st">"asb_vertices"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`Upper mesopelagic`
 [1] "Stomias_boa"                "Melanostigma_atlanticum"   
 [3] "Argyropelecus_olfersii"     "Evermannella_balbo"        
 [5] "Serrivomer_beanii"          "Xenodermichthys_copei"     
 [7] "Borostomias_antarcticus"    "Sagamichthys_schnakenbecki"
 [9] "Maurolicus_muelleri"        "Lampanyctus_crocodilus"    
[11] "Holtbyrnia_macrops"         "Arctozenus_risso"          
[13] "Maulisia_mauli"             "Lestidiops_sphyrenoides"   
[15] "Lobianchia_gemellarii"      "Benthosema_glaciale"       
[17] "Chauliodus_sloani"          "Malacosteus_niger"         
[19] "Ceratoscopelus_maderensis"  "Derichthys_serpentinus"    
[21] "Paralepis_coregonoides"     "Argyropelecus_hemigymnus"  
[23] "Melanostomias_bartonbeani" 

$Bathypelagic
 [1] "Evermannella_balbo"        "Borostomias_antarcticus"  
 [3] "Malacosteus_niger"         "Gonostoma_elongatum"      
 [5] "Lampanyctus_macdonaldi"    "Melanostigma_atlanticum"  
 [7] "Derichthys_serpentinus"    "Maulisia_microlepis"      
 [9] "Sigmops_bathyphilus"       "Lestidiops_sphyrenoides"  
[11] "Argyropelecus_hemigymnus"  "Lampanyctus_crocodilus"   
[13] "Ceratoscopelus_maderensis" "Maulisia_argipalla"       
[15] "Benthosema_glaciale"       "Maurolicus_muelleri"      
[17] "Maulisia_mauli"            "Stomias_boa"              
[19] "Paralepis_coregonoides"    "Argyropelecus_olfersii"   
[21] "Chauliodus_sloani"         "Serrivomer_beanii"        
[23] "Arctozenus_risso"          "Bathylagus_euryops"       
[25] "Anoplogaster_cornuta"      "Holtbyrnia_anomala"       
[27] "Melanostomias_bartonbeani"

$Epipelagic
 [1] "Stomias_boa"               "Melanostigma_atlanticum"  
 [3] "Lobianchia_gemellarii"     "Arctozenus_risso"         
 [5] "Borostomias_antarcticus"   "Argyropelecus_olfersii"   
 [7] "Maurolicus_muelleri"       "Lestidiops_sphyrenoides"  
 [9] "Xenodermichthys_copei"     "Sigmops_bathyphilus"      
[11] "Myctophum_punctatum"       "Ceratoscopelus_maderensis"
[13] "Chauliodus_sloani"         "Paralepis_coregonoides"   
[15] "Benthosema_glaciale"       "Lampanyctus_crocodilus"   
[17] "Serrivomer_beanii"         "Melanostomias_bartonbeani"
[19] "Argyropelecus_hemigymnus" 

$`Lower mesopelagic`
 [1] "Stomias_boa"                 "Ceratoscopelus_maderensis"  
 [3] "Argyropelecus_olfersii"      "Melanostigma_atlanticum"    
 [5] "Arctozenus_risso"            "Maulisia_mauli"             
 [7] "Bolinichthys_supralateralis" "Borostomias_antarcticus"    
 [9] "Maurolicus_muelleri"         "Benthosema_glaciale"        
[11] "Serrivomer_beanii"           "Xenodermichthys_copei"      
[13] "Maulisia_argipalla"          "Lestidiops_sphyrenoides"    
[15] "Holtbyrnia_macrops"          "Gonostoma_elongatum"        
[17] "Sagamichthys_schnakenbecki"  "Chauliodus_sloani"          
[19] "Evermannella_balbo"          "Lampanyctus_crocodilus"     
[21] "Derichthys_serpentinus"      "Paralepis_coregonoides"     
[23] "Argyropelecus_hemigymnus"    "Melanostomias_bartonbeani"  </code></pre>
</div>
</div>
<ul>
<li>overlap between convex hulls shaping each of the two species assemblages.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>beta_plot_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.multidim.plot</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_beta_fd_multidim =</span> beta_fd_indices_fish,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm             =</span> <span class="fu">c</span>(<span class="st">"Epipelagic"</span>, <span class="st">"Upper mesopelagic"</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_family             =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm              =</span> <span class="fu">c</span>(<span class="st">"Maurolicus_muelleri"</span>, <span class="st">"Lampanyctus_crocodilus"</span>, <span class="st">"Argyropelecus_olfersii"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                   =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file               =</span> <span class="cn">NULL</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                =</span> <span class="cn">NULL</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes             =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input             =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>beta_plot_fish<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_beta_FD_epi_up-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>beta_plot_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.multidim.plot</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_beta_fd_multidim =</span> beta_fd_indices_fish,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm             =</span> <span class="fu">c</span>(<span class="st">"Upper mesopelagic"</span>, <span class="st">"Lower mesopelagic"</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_family             =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm              =</span> <span class="fu">c</span>(<span class="st">"Maulisia_mauli"</span>, <span class="st">"Evermannella_balbo"</span>, <span class="st">"Borostomias_antarcticus"</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                   =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file               =</span> <span class="cn">NULL</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                =</span> <span class="cn">NULL</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes             =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input             =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>beta_plot_fish<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_beta_FD_up_lw-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>beta_plot_fish <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">beta.multidim.plot</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_beta_fd_multidim =</span> beta_fd_indices_fish,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_asb_nm             =</span> <span class="fu">c</span>(<span class="st">"Lower mesopelagic"</span>, <span class="st">"Bathypelagic"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_family             =</span> <span class="fu">c</span>(<span class="st">"Jaccard"</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sp_nm              =</span> <span class="fu">c</span>(<span class="st">"Anoplogaster_cornuta"</span>, <span class="st">"Holtbyrnia_anomala"</span>, <span class="st">"Photostylus_pycnopterus"</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes                   =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_file               =</span> <span class="cn">NULL</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">faxes_nm                =</span> <span class="cn">NULL</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_faxes             =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_input             =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>beta_plot_fish<span class="sc">$</span><span class="st">"patchwork"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_beta_FD_lw_b-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
</section>
<section id="functional-rarity" class="level1">
<h1>4. Functional rarity</h1>
<section id="different-indices-of-functional-rarity" class="level2">
<h2 class="anchored" data-anchor-id="different-indices-of-functional-rarity">4.1 Different indices of functional rarity</h2>
<p><span style="color:#2596be;"><strong>Functional originality indices</strong></span>:</p>
<ul>
<li><p><strong>Functional distinctiveness</strong> is the mean of dissimilarity of the focal species to all the other species of the set of interest. It can be abundance-weighted if needed.</p></li>
<li><p><strong>Functional uniqueness</strong> is the smallest dissimilarity that exists between the focal species and the all other species in the set. It does not consider the abundance of any species.</p></li>
</ul>
<p><span style="color:#2596be;"><strong>Rarity indices</strong></span>:</p>
<ul>
<li><p><strong>Scarcity</strong> is proportional to the relative abundance of the species. It gets close to one when the species is (relatively) rare and close to 0 when its dominant</p></li>
<li><p><strong>Restrictedness</strong> is 1 minus the ratio of sites a species occupy over the total number of sites.</p></li>
</ul>
</section>
<section id="computing-functional-rarity" class="level2">
<h2 class="anchored" data-anchor-id="computing-functional-rarity">4.2.Computing functional rarity</h2>
<section id="functional-originality-at-regional-scale" class="level3">
<h3 class="anchored" data-anchor-id="functional-originality-at-regional-scale">4.2.1 Functional originality at regional scale</h3>
<ul>
<li>For the choice or dissimilarity matrix we can use the raw dissimilarity matrix computed directly on raw traits values among species:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sp_di <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">distinctiveness_global</span>(sp_dist_fish, <span class="at">di_name =</span> <span class="st">"distinctiveness"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(sp_di))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-aa372a93a0ac350e105b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-aa372a93a0ac350e105b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41"],["Anoplogaster_cornuta","Arctozenus_risso","Argyropelecus_hemigymnus","Argyropelecus_olfersii","Bathylagus_euryops","Benthosema_glaciale","Bolinichthys_supralateralis","Borostomias_antarcticus","Ceratoscopelus_maderensis","Chauliodus_sloani","Cyclothone_sp","Derichthys_serpentinus","Diaphus_metopoclampus","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Holtbyrnia_macrops","Lampanyctus_ater","Lampanyctus_crocodilus","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Malacosteus_niger","Maulisia_argipalla","Maulisia_mauli","Maulisia_microlepis","Maurolicus_muelleri","Melanostigma_atlanticum","Melanostomias_bartonbeani","Myctophum_punctatum","Normichthys_operosus","Notoscopelus_bolini","Notoscopelus_kroyeri","Paralepis_coregonoides","Photostylus_pycnopterus","Sagamichthys_schnakenbecki","Searsia_koefoedi","Serrivomer_beanii","Sigmops_bathyphilus","Stomias_boa","Xenodermichthys_copei"],[0.3668772626168548,0.2529676099854551,0.2946777813742018,0.2943802300138824,0.2245779581869246,0.2246599240484081,0.2333277385144243,0.2714679057964132,0.2158933188549138,0.3868479665814772,0.2840939938238449,0.2981434226609408,0.2373125800145302,0.3488074925386992,0.2828995795133522,0.2475420309894603,0.2128350987726451,0.1947354631039703,0.2174191764724976,0.2381432773516548,0.2491495060171916,0.2111727024550822,0.3700755567907904,0.2125914632007417,0.204009308275686,0.2488000724526063,0.2247798088260556,0.2870297249986952,0.3792172282546871,0.2034832430677826,0.1986325786972981,0.1948561210059207,0.199054250102451,0.2974681046303838,0.2503363471916696,0.2145326484492943,0.1924533697781431,0.3246815676155657,0.2390844389464392,0.3762515007733525,0.2434193348189186]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>species<\/th>\n      <th>distinctiveness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>Another option would be to compute a new functional dissimilarity matrix based on the selected functional axes. One advantage of the latter is that it already takes into account the correlation between traits (recompute regional functional distinctiveness based on the n selected functional axes. Because the space comes from a PCA, we can directly use euclidean distance):</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>new_dissim <span class="ot">&lt;-</span> <span class="fu">dist</span>(sp_faxes_coord_fish[, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)])</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>sp_di_alt <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">distinctiveness_global</span>(new_dissim, <span class="at">di_name =</span> <span class="st">"alt_di"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#We can now compare both distinctiveness values.</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>sp_all_di <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_di, sp_di_alt, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp_all_di<span class="sc">$</span>distinctiveness, sp_all_di<span class="sc">$</span>alt_di)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/distinctiveness_n_axis-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(sp_all_di<span class="sc">$</span>distinctiveness, sp_all_di<span class="sc">$</span>alt_di)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  sp_all_di$distinctiveness and sp_all_di$alt_di
t = 25.003, df = 39, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.9444435 0.9841082
sample estimates:
      cor 
0.9701954 </code></pre>
</div>
</div>
<p>Both seems very correlated, so in our case using either one should be fine. However, it can be better to use dissimilarity based on a reduced number of well-defined axes because: (1) there are more interpretable thanks to the multivariate analysis, (2) the first one contain of the most information, (3) they explicitly take into account potentially strong correlations between provided traits. We’ll stick here with raw dissimilarity for the sake of simplicity</p>
<p>To compute uniqueness at regional scale we also need the regional level functional dissimilarity matrix with the uniqueness() function, and the site-species matrix:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sp_ui <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">uniqueness</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pres_matrix =</span> depth_fish_biomass,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>(sp_dist_fish)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(sp_ui<span class="sc">$</span>Ui, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        10%        20%        30%        40%        50%        60% 
0.03861127 0.04734512 0.05180288 0.06772377 0.07558509 0.10822527 0.12548328 
       70%        80%        90%       100% 
0.14133964 0.16519174 0.19158608 0.22482167 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">tagList</span>(DT<span class="sc">::</span><span class="fu">datatable</span>(sp_ui))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d6ab47753c8bc3ee2138" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d6ab47753c8bc3ee2138">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41"],["Anoplogaster_cornuta","Arctozenus_risso","Argyropelecus_hemigymnus","Argyropelecus_olfersii","Bathylagus_euryops","Benthosema_glaciale","Bolinichthys_supralateralis","Borostomias_antarcticus","Ceratoscopelus_maderensis","Chauliodus_sloani","Cyclothone_sp","Derichthys_serpentinus","Diaphus_metopoclampus","Evermannella_balbo","Gonostoma_elongatum","Holtbyrnia_anomala","Holtbyrnia_macrops","Lampanyctus_crocodilus","Lampanyctus_macdonaldi","Lestidiops_sphyrenoides","Lobianchia_gemellarii","Malacosteus_niger","Maulisia_argipalla","Maulisia_mauli","Maulisia_microlepis","Maurolicus_muelleri","Melanostigma_atlanticum","Melanostomias_bartonbeani","Myctophum_punctatum","Lampanyctus_ater","Normichthys_operosus","Notoscopelus_kroyeri","Paralepis_coregonoides","Photostylus_pycnopterus","Sagamichthys_schnakenbecki","Searsia_koefoedi","Serrivomer_beanii","Sigmops_bathyphilus","Stomias_boa","Xenodermichthys_copei","Notoscopelus_bolini"],[0.2216999532825106,0.05056694527832013,0.1126089790952527,0.1126089790952527,0.1254832848934597,0.07558508715979755,0.1082252738506514,0.1395090868782561,0.04734512251457217,0.2186657964261447,0.1599092853533166,0.1590709547722683,0.1106351643187424,0.2248216724205994,0.1280197844326792,0.07856781840615111,0.05812991482354539,0.0677237699161883,0.07062176809492998,0.05056694527832013,0.07062176809492998,0.2216999532825106,0.03861126714074527,0.03861126714074527,0.1413396442089121,0.1013793052923886,0.1438711573044715,0.1915860755088155,0.04734512251457217,0.0677237699161883,0.04407512470334325,0.0518028800247474,0.1771860011042057,0.1651917420855135,0.05812991482354539,0.04407512470334325,0.1661931491752429,0.09853782491490212,0.1915860755088155,0.1344418026160116,0.0518028800247474]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>species<\/th>\n      <th>Ui<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Based on these results we see that <em>Serrivomer beanii</em>, <em>Anoplogaster cornuta</em>, and <em>Malacosteus niger</em> are the most isolated fish in the functional space. Meaning that they have the most distant nearest neighbors.</p>
</section>
<section id="functional-originality-at-local-scale" class="level3">
<h3 class="anchored" data-anchor-id="functional-originality-at-local-scale">4.2.2 Functional originality at local scale</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sp_local_di <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">distinctiveness</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  depth_fish_biomass, <span class="fu">as.matrix</span>(sp_dist_fish)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>sp_local_di[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  Anoplogaster_cornuta Arctozenus_risso
Upper mesopelagic                   NA        0.2161728
Bathypelagic                 0.3767824        0.2229648
Epipelagic                          NA        0.2079065
Lower mesopelagic                   NA        0.2194040
                  Argyropelecus_hemigymnus Argyropelecus_olfersii
Upper mesopelagic                0.2660142              0.2756554
Bathypelagic                     0.2938755              0.2923411
Epipelagic                       0.2665793              0.2925497
Lower mesopelagic                0.2834153              0.2809862
                  Bathylagus_euryops Benthosema_glaciale
Upper mesopelagic                 NA           0.2173321
Bathypelagic               0.2092679           0.2040058
Epipelagic                        NA           0.1667439
Lower mesopelagic                 NA           0.2115402
                  Bolinichthys_supralateralis Borostomias_antarcticus
Upper mesopelagic                          NA               0.2787882
Bathypelagic                        0.2121591               0.2608313
Epipelagic                                 NA               0.2699629
Lower mesopelagic                   0.2291705               0.2684266
                  Ceratoscopelus_maderensis Chauliodus_sloani
Upper mesopelagic                 0.1948874         0.3953637
Bathypelagic                      0.1814621         0.4071009
Epipelagic                        0.1516539         0.4016180
Lower mesopelagic                 0.1897701         0.3932241</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">dim</span>(sp_local_di), <span class="fu">dim</span>(depth_fish_biomass))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>To compute uniqueness at the site scale, we must use a more complex expression as it was not envisioned for local computation:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>depth_ui <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  depth_fish_biomass, <span class="dv">1</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(single_site, dist_m) {</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    single_site <span class="ot">=</span> single_site[single_site <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(single_site)]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    funrar<span class="sc">::</span><span class="fu">uniqueness</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(single_site)), dist_m)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">dist_m =</span> <span class="fu">as.matrix</span>(sp_dist_fish)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(depth_ui[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`Upper mesopelagic`
                      species         Ui
1            Arctozenus_risso 0.05056695
2    Argyropelecus_hemigymnus 0.11260898
3      Argyropelecus_olfersii 0.11260898
4         Benthosema_glaciale 0.07558509
5     Borostomias_antarcticus 0.13950909
6   Ceratoscopelus_maderensis 0.04734512
7           Chauliodus_sloani 0.21866580
8               Cyclothone_sp 0.19799107
9      Derichthys_serpentinus 0.15907095
10         Evermannella_balbo 0.22482167
11         Holtbyrnia_macrops 0.05812991
12     Lampanyctus_crocodilus 0.06772377
13    Lestidiops_sphyrenoides 0.05056695
14      Lobianchia_gemellarii 0.08383755
15          Malacosteus_niger 0.22945080
16             Maulisia_mauli 0.08718195
17        Maurolicus_muelleri 0.10137931
18    Melanostigma_atlanticum 0.14387116
19  Melanostomias_bartonbeani 0.19158608
20        Myctophum_punctatum 0.04734512
21           Lampanyctus_ater 0.06772377
22       Notoscopelus_kroyeri 0.05234555
23     Paralepis_coregonoides 0.17718600
24 Sagamichthys_schnakenbecki 0.05812991
25           Searsia_koefoedi 0.08718195
26          Serrivomer_beanii 0.16619315
27                Stomias_boa 0.19158608
28      Xenodermichthys_copei 0.13634869</code></pre>
</div>
</div>
<p>As we had to manually build the function to compute the local uniqueness the results are strangely formatted.</p>
<p>We provide here a function that can help them to be more easily read:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>depth_ui <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(depth_ui), <span class="cf">function</span>(x) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  single_depth <span class="ot">=</span> depth_ui[[x]]</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  single_depth<span class="sc">$</span>site <span class="ot">=</span> x</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(single_depth)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>depth_ui <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, depth_ui)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Then we can again look at the apple to see how its uniqueness varies across depths.</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(depth_ui, species <span class="sc">==</span> <span class="st">"Melanostomias_bartonbeani"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      species        Ui              site
19  Melanostomias_bartonbeani 0.1915861 Upper mesopelagic
56  Melanostomias_bartonbeani 0.1915861      Bathypelagic
83  Melanostomias_bartonbeani 0.1915861        Epipelagic
115 Melanostomias_bartonbeani 0.1915861 Lower mesopelagic</code></pre>
</div>
</div>
<p>4.3.3.Rarity indices</p>
<p><strong>scarcity</strong>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rel_weights <span class="ot">=</span> funrar<span class="sc">::</span><span class="fu">make_relative</span>(depth_fish_biomass)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>si <span class="ot">=</span>  funrar<span class="sc">::</span><span class="fu">scarcity</span>(rel_weights)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Anoplogaster_cornuta Arctozenus_risso Argyropelecus_hemigymnus
 Min.   :0.9469       Min.   :0.2134   Min.   :0.9614          
 1st Qu.:0.9469       1st Qu.:0.2287   1st Qu.:0.9834          
 Median :0.9469       Median :0.3691   Median :0.9921          
 Mean   :0.9469       Mean   :0.3647   Mean   :0.9848          
 3rd Qu.:0.9469       3rd Qu.:0.5051   3rd Qu.:0.9935          
 Max.   :0.9469       Max.   :0.5071   Max.   :0.9935          
 NA's   :3                                                     
 Argyropelecus_olfersii Bathylagus_euryops Benthosema_glaciale
 Min.   :0.1540         Min.   :0.2453     Min.   :0.1356     
 1st Qu.:0.4553         1st Qu.:0.2453     1st Qu.:0.1394     
 Median :0.5710         Median :0.2453     Median :0.3708     
 Mean   :0.5182         Mean   :0.2453     Mean   :0.4454     
 3rd Qu.:0.6340         3rd Qu.:0.2453     3rd Qu.:0.6768     
 Max.   :0.7769         Max.   :0.2453     Max.   :0.9043     
                        NA's   :3                             
 Bolinichthys_supralateralis Borostomias_antarcticus Ceratoscopelus_maderensis
 Min.   :0.9149              Min.   :0.7715          Min.   :0.2463           
 1st Qu.:0.9303              1st Qu.:0.9258          1st Qu.:0.3191           
 Median :0.9457              Median :0.9844          Median :0.5262           
 Mean   :0.9457              Mean   :0.9334          Mean   :0.5043           
 3rd Qu.:0.9612              3rd Qu.:0.9919          3rd Qu.:0.7114           
 Max.   :0.9766              Max.   :0.9933          Max.   :0.7185           
 NA's   :2                                                                    
 Chauliodus_sloani Cyclothone_sp    Derichthys_serpentinus
 Min.   :0.6115    Min.   :0.4303   Min.   :0.9524        
 1st Qu.:0.8156    1st Qu.:0.6259   1st Qu.:0.9638        
 Median :0.9346    Median :0.8080   Median :0.9753        
 Mean   :0.8682    Mean   :0.7498   Mean   :0.9721        
 3rd Qu.:0.9873    3rd Qu.:0.9319   3rd Qu.:0.9819        
 Max.   :0.9922    Max.   :0.9531   Max.   :0.9886        
                                    NA's   :1             
 Diaphus_metopoclampus Evermannella_balbo Gonostoma_elongatum
 Min.   :0.9915        Min.   :0.8236     Min.   :0.8551     
 1st Qu.:0.9925        1st Qu.:0.9010     1st Qu.:0.8769     
 Median :0.9935        Median :0.9784     Median :0.8987     
 Mean   :0.9935        Mean   :0.9313     Mean   :0.8987     
 3rd Qu.:0.9945        3rd Qu.:0.9852     3rd Qu.:0.9205     
 Max.   :0.9955        Max.   :0.9921     Max.   :0.9423     
 NA's   :2             NA's   :1          NA's   :2          
 Holtbyrnia_anomala Holtbyrnia_macrops Lampanyctus_crocodilus
 Min.   :0.9014     Min.   :0.9760     Min.   :0.002127      
 1st Qu.:0.9014     1st Qu.:0.9794     1st Qu.:0.002955      
 Median :0.9014     Median :0.9829     Median :0.023844      
 Mean   :0.9014     Mean   :0.9820     Mean   :0.063790      
 3rd Qu.:0.9014     3rd Qu.:0.9851     3rd Qu.:0.084679      
 Max.   :0.9014     Max.   :0.9872     Max.   :0.205344      
 NA's   :3          NA's   :1                                
 Lampanyctus_macdonaldi Lestidiops_sphyrenoides Lobianchia_gemellarii
 Min.   :0.3235         Min.   :0.8648          Min.   :0.7642       
 1st Qu.:0.3235         1st Qu.:0.9171          1st Qu.:0.8764       
 Median :0.3235         Median :0.9611          Median :0.9206       
 Mean   :0.3235         Mean   :0.9452          Mean   :0.8896       
 3rd Qu.:0.3235         3rd Qu.:0.9893          3rd Qu.:0.9338       
 Max.   :0.3235         Max.   :0.9938          Max.   :0.9529       
 NA's   :3                                                           
 Malacosteus_niger Maulisia_argipalla Maulisia_mauli   Maulisia_microlepis
 Min.   :0.7746    Min.   :0.9082     Min.   :0.5169   Min.   :0.636      
 1st Qu.:0.8230    1st Qu.:0.9143     1st Qu.:0.7431   1st Qu.:0.636      
 Median :0.8714    Median :0.9204     Median :0.9693   Median :0.636      
 Mean   :0.8714    Mean   :0.9204     Mean   :0.8274   Mean   :0.636      
 3rd Qu.:0.9199    3rd Qu.:0.9265     3rd Qu.:0.9827   3rd Qu.:0.636      
 Max.   :0.9683    Max.   :0.9326     Max.   :0.9962   Max.   :0.636      
 NA's   :2         NA's   :2          NA's   :1        NA's   :3          
 Maurolicus_muelleri Melanostigma_atlanticum Melanostomias_bartonbeani
 Min.   :0.1886      Min.   :0.9008          Min.   :0.8833           
 1st Qu.:0.2219      1st Qu.:0.9239          1st Qu.:0.8853           
 Median :0.5207      Median :0.9559          Median :0.8959           
 Mean   :0.5326      Mean   :0.9494          Mean   :0.9099           
 3rd Qu.:0.8314      3rd Qu.:0.9814          3rd Qu.:0.9205           
 Max.   :0.9004      Max.   :0.9851          Max.   :0.9643           
                                                                      
 Myctophum_punctatum Lampanyctus_ater Normichthys_operosus Notoscopelus_kroyeri
 Min.   :0.03938     Min.   :0.4225   Min.   :0.05469      Min.   :0.1010      
 1st Qu.:0.37194     1st Qu.:0.6571   1st Qu.:0.05469      1st Qu.:0.1879      
 Median :0.49303     Median :0.8502   Median :0.05469      Median :0.2641      
 Mean   :0.40881     Mean   :0.7758   Mean   :0.05469      Mean   :0.2624      
 3rd Qu.:0.52991     3rd Qu.:0.9689   3rd Qu.:0.05469      3rd Qu.:0.3385      
 Max.   :0.60979     Max.   :0.9802   Max.   :0.05469      Max.   :0.4204      
                                      NA's   :3                                
 Paralepis_coregonoides Photostylus_pycnopterus Sagamichthys_schnakenbecki
 Min.   :0.9799         Min.   :0.967           Min.   :0.9254            
 1st Qu.:0.9850         1st Qu.:0.967           1st Qu.:0.9518            
 Median :0.9878         Median :0.967           Median :0.9781            
 Mean   :0.9885         Mean   :0.967           Mean   :0.9626            
 3rd Qu.:0.9913         3rd Qu.:0.967           3rd Qu.:0.9812            
 Max.   :0.9986         Max.   :0.967           Max.   :0.9842            
                        NA's   :3               NA's   :1                 
 Searsia_koefoedi Serrivomer_beanii Sigmops_bathyphilus  Stomias_boa    
 Min.   :0.5343   Min.   :0.06388   Min.   :0.8843      Min.   :0.1705  
 1st Qu.:0.5941   1st Qu.:0.30782   1st Qu.:0.9099      1st Qu.:0.1941  
 Median :0.6536   Median :0.43842   Median :0.9355      Median :0.2049  
 Mean   :0.6788   Mean   :0.40540   Mean   :0.9355      Mean   :0.2273  
 3rd Qu.:0.7382   3rd Qu.:0.53599   3rd Qu.:0.9611      3rd Qu.:0.2381  
 Max.   :0.8737   Max.   :0.68088   Max.   :0.9867      Max.   :0.3289  
                                    NA's   :2                           
 Xenodermichthys_copei Notoscopelus_bolini
 Min.   :0.001095      Min.   :0.3286     
 1st Qu.:0.008536      1st Qu.:0.6478     
 Median :0.106440      Median :0.9670     
 Mean   :0.186479      Mean   :0.7558     
 3rd Qu.:0.284382      3rd Qu.:0.9693     
 Max.   :0.531940      Max.   :0.9717     
                       NA's   :1          </code></pre>
</div>
</div>
<p>__ restrictiveness__:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ri <span class="ot">=</span> funrar<span class="sc">::</span><span class="fu">restrictedness</span>(depth_fish_biomass)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ri)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   species                Ri        
 Length:41          Min.   :0.0000  
 Class :character   1st Qu.:0.0000  
 Mode  :character   Median :0.0000  
                    Mean   :0.2378  
                    3rd Qu.:0.5000  
                    Max.   :0.7500  </code></pre>
</div>
</div>
</section>
</section>
<section id="plotting-functional-rarity" class="level2">
<h2 class="anchored" data-anchor-id="plotting-functional-rarity">4.3 Plotting functional rarity</h2>
<section id="plotting-functional-originality" class="level3">
<h3 class="anchored" data-anchor-id="plotting-functional-originality">4.3.1 Plotting functional originality</h3>
<p>option to be able to colour species according to their functional originality (and not use the ready-made functions in the mfd package)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a summary data.frame</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sp_faxes_coord_fish[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sp_coord_di_ui)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sp_coord_di_ui) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> sp_coord_di_ui[, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_coord_di_ui, sp_di, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>sp_coord_di_ui <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_coord_di_ui, sp_ui, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>plot_reg_distinctiveness <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_coord_di_ui, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> distinctiveness), <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">high =</span> <span class="st">"#914568"</span>, <span class="at">low =</span> <span class="st">"#6BA1B9"</span>, <span class="st">"Functional</span><span class="sc">\n</span><span class="st">Distinctiveness"</span>)<span class="sc">+</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>plot_reg_uniqueness <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_coord_di_ui, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Ui), <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">high =</span> <span class="st">"#914568"</span>, <span class="at">low =</span> <span class="st">"#6BA1B9"</span>,<span class="st">"Functional</span><span class="sc">\n</span><span class="st">Uniqueness"</span>) <span class="sc">+</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(plot_reg_distinctiveness, plot_reg_uniqueness)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_si_ri-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
<ul>
<li><p>As was done with mFD to correlate the functional axes with species’ traits we can correlate functional distinctiveness to specific traits in order to see which traits are mainly driving distinctiveness.</p></li>
<li><p>Regarding local level functional originality indices, the visualization can be more difficult to grasp and depends highly on the question. Would you rather focus on visualizing the functional distinctiveness of one species across communities? Compare the distribution of functional distinctiveness values across communities?</p></li>
<li><p>One idea to keep in mind is that averaging functional distinctiveness per community is exactly equal to computing functional dispersion. Functional originality is computed on a species basis, so we should be aware that if we are rather interested by community properties than we can compute functional diversity metrics which are much more appropriate.</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>local_di_ap <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sp_local_di[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> <span class="dv">11</span>)])</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>local_di_ap<span class="sc">$</span>depth <span class="ot">&lt;-</span> <span class="fu">rownames</span>(local_di_ap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-rarity" class="level3">
<h3 class="anchored" data-anchor-id="plotting-rarity">4.3.2. Plotting rarity</h3>
<ul>
<li><strong>Functional Distinctiveness</strong></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sp_di_ri <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_di, ri, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>sp_di_ri_ui <span class="ot">&lt;-</span> <span class="fu">merge</span>(sp_di_ri, sp_ui, <span class="at">by =</span> <span class="st">"species"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>plot_dist_ri_reg <span class="ot">&lt;-</span><span class="fu">ggplot</span>(sp_di_ri, <span class="fu">aes</span>(distinctiveness, Ri)) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">max.overlaps=</span><span class="dv">22</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Distinctiveness"</span>, <span class="at">y =</span> <span class="st">"Geographical Restrictedness"</span>) <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>plot_dist_ri_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dist_ri_reg-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>On this visualization we can clearly see that <em>Anoplogaster cornuta</em> is overall the most distinct species while being quite restricted in terms of depth. On the other hand, the two Myctophidae <em>Lampanyctus ater</em> and <em>Lobianchia_gemellarii</em> are the most functionally common and regionally widespread species (low restrictedness).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># median depth of species </span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>median_depth_fish <span class="ot">&lt;-</span> depth_distribution<span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species)<span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_depth=</span> <span class="fu">median</span>(depth))</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>sp_di_ri_depth <span class="ot">&lt;-</span> sp_di_ri<span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(median_depth_fish)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>sp_di_ri_depth_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_di_ri_depth, <span class="fu">aes</span>(distinctiveness, Ri)) <span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span>median_depth), <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">max.overlaps=</span><span class="dv">22</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Distinctiveness"</span>, <span class="at">y =</span> <span class="st">"Geographical Restrictedness"</span>) <span class="sc">+</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">high =</span> <span class="st">"#00263A"</span>, <span class="at">low =</span> <span class="st">"#C5F8FF"</span>,<span class="st">"Median depth (m)"</span>) <span class="sc">+</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>sp_di_ri_depth_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dist_ri_reg_depth-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><strong>Functional Uniqueness</strong></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plot_ui_ri_reg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_di_ri_ui, <span class="fu">aes</span>(Ui, Ri)) <span class="sc">+</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">max.overlaps=</span><span class="dv">22</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Uniqueness"</span>, <span class="at">y =</span> <span class="st">"Geographical Restrictedness"</span>) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>plot_ui_ri_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_ui_ri_reg-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sp_di_ri_ui_depth <span class="ot">&lt;-</span> sp_di_ri_ui<span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(median_depth_fish)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>plot_ui_ri_reg_depth <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_di_ri_ui_depth, <span class="fu">aes</span>(Ui, Ri)) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span>median_depth), <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species), <span class="at">max.overlaps=</span><span class="dv">22</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Uniqueness"</span>, <span class="at">y =</span> <span class="st">"Geographical Restrictedness"</span>) <span class="sc">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">high =</span> <span class="st">"#00263A"</span>, <span class="at">low =</span> <span class="st">"#C5F8FF"</span>,<span class="st">"Median depth (m)"</span>) <span class="sc">+</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>plot_ui_ri_reg_depth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_ui_ri_reg_depth-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>plot local scale measurements:</li>
</ul>
<p><strong>bathypelagic layer</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sp_local_di_df <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">matrix_to_stack</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  sp_local_di, <span class="at">value_col =</span> <span class="st">"local_di"</span>, <span class="at">row_to_col =</span> <span class="st">"depth"</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_to_col =</span> <span class="st">"species"</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>sp_local_si_df <span class="ot">&lt;-</span> funrar<span class="sc">::</span><span class="fu">matrix_to_stack</span>(</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  si, <span class="at">value_col =</span> <span class="st">"local_si"</span>, <span class="at">row_to_col =</span> <span class="st">"depth"</span>, <span class="at">col_to_col =</span> <span class="st">"species"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>sp_local_di_si <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  sp_local_di_df, sp_local_si_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"depth"</span>, <span class="st">"species"</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sp_local_di_si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         depth                  species  local_di  local_si
1 Bathypelagic     Anoplogaster_cornuta 0.3767824 0.9469379
2 Bathypelagic         Arctozenus_risso 0.2229648 0.5071105
3 Bathypelagic Argyropelecus_hemigymnus 0.2938755 0.9935434
4 Bathypelagic   Argyropelecus_olfersii 0.2923411 0.5556566
5 Bathypelagic       Bathylagus_euryops 0.2092679 0.2453489
6 Bathypelagic      Benthosema_glaciale 0.2040058 0.1406685</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>plot_local_di_si <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_local_di_si, <span class="fu">aes</span>(local_di, local_si)) <span class="sc">+</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Functional Distinctiveness"</span>, <span class="at">y =</span> <span class="st">"Scarcity"</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>plot_local_di_si</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_local_di_si-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>